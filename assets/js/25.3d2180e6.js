(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{312:function(e,a,t){"use strict";t.r(a);var s=t(8),n=Object(s.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"monitoring-and-logging"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monitoring-and-logging"}},[e._v("#")]),e._v(" Monitoring and Logging")]),e._v(" "),a("h2",{attrs:{id:"metrics-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metrics-server"}},[e._v("#")]),e._v(" metrics-server")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("metrics-server")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/bitnami/metrics-server",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/bitnami/charts/blob/master/bitnami/metrics-server/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update bitnami https://charts.bitnami.com/bitnami\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("5.9")]),e._v(".2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - metrics-server bitnami/metrics-server "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\napiService:\n  create: true\n# Needed for Calico\nhostNetwork: true\nEOF")]),e._v("\n")])])]),a("h2",{attrs:{id:"prometheus-adapter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-adapter"}},[e._v("#")]),e._v(" prometheus-adapter")]),e._v(" "),a("p",[e._v("Installs the Prometheus Adapter for the Custom Metrics API.\nCustom metrics are used in Kubernetes by Horizontal Pod Autoscaler to scale\nworkloads based upon your own metric pulled from an external metrics provider\nlike Prometheus.\nIt can also replace the "),a("a",{attrs:{href:"https://github.com/kubernetes-incubator/metrics-server",target:"_blank",rel:"noopener noreferrer"}},[e._v("metrics server"),a("OutboundLink")],1),e._v("\non clusters that already run Prometheus and collect the appropriate metrics.")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("prometheus-adapter")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/prometheus-community/prometheus-adapter",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/prometheus-community/helm-charts/blob/main/charts/prometheus-adapter/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update prometheus-community https://prometheus-community.github.io/helm-charts\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2.15")]),e._v(".2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" prometheus-adapter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - prometheus-adapter prometheus-community/prometheus-adapter "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\n# Needed for Calico\nhostNetwork:\n  enabled: true\nEOF")]),e._v("\n")])])]),a("h2",{attrs:{id:"kube-prometheus-stack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kube-prometheus-stack"}},[e._v("#")]),e._v(" kube-prometheus-stack")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("kube-prometheus-stack")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/prometheus-community/helm-charts/blob/main/charts/kube-prometheus-stack/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update prometheus-community https://prometheus-community.github.io/helm-charts\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("17.2")]),e._v(".1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" kube-prometheus-stack "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - kube-prometheus-stack prometheus-community/kube-prometheus-stack "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('EOF\ndefaultRules:\n  rules:\n    etcd: false\n    kubernetesSystem: false\n    kubeScheduler: false\nadditionalPrometheusRulesMap:\n  # Flux rule: https://toolkit.fluxcd.io/guides/monitoring/\n  rule-name:\n    groups:\n    - name: GitOpsToolkit\n      rules:\n      - alert: ReconciliationFailure\n        expr: max(gotk_reconcile_condition{status="False",type="Ready"}) by (namespace, name, kind) + on(namespace, name, kind) (max(gotk_reconcile_condition{status="Deleted"}) by (namespace, name, kind)) * 2 == 1\n        for: 10m\n        labels:\n          severity: page\n        annotations:\n          summary: "{{ \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$labels")]),e._v(".kind }} {{ \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$labels")]),e._v(".namespace }}/{{ \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$labels")]),e._v('.name }} reconciliation has been failing for more than ten minutes."\n    # https://github.com/openstack/openstack-helm-infra/blob/master/prometheus/values_overrides/kubernetes.yaml\n    - name: calico.rules\n      rules:\n      - alert: prom_exporter_calico_unavailable\n        expr: avg_over_time(up{job="kubernetes-pods",application="calico"}[5m]) == 0\n        for: 10m\n        labels:\n          severity: warning\n        annotations:\n          description: Calico exporter is not collecting metrics or is not available for past 10 minutes\n          title: Calico exporter is not collecting metrics or is not available\n      - alert: calico_datapane_failures_high_1h\n        expr: absent(felix_int_dataplane_failures) OR increase(felix_int_dataplane_failures[1h]) > 5\n        labels:\n          severity: page\n        annotations:\n          description: "Felix instance {{ \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$labels")]),e._v(".instance }} has seen {{ \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$value")]),e._v(' }} dataplane failures within the last hour"\n          summary: "A high number of dataplane failures within Felix are happening"\n      - alert: calico_datapane_address_msg_batch_size_high_5m\n        expr: absent(felix_int_dataplane_addr_msg_batch_size_sum) OR absent(felix_int_dataplane_addr_msg_batch_size_count) OR (felix_int_dataplane_addr_msg_batch_size_sum/felix_int_dataplane_addr_msg_batch_size_count) > 5\n        for: 5m\n        labels:\n          severity: page\n        annotations:\n          description: "Felix instance {{ \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$labels")]),e._v(".instance }} has seen a high value of {{ \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$value")]),e._v(' }} dataplane address message batch size"\n          summary: "Felix address message batch size is higher"\n      - alert: calico_datapane_iface_msg_batch_size_high_5m\n        expr: absent(felix_int_dataplane_iface_msg_batch_size_sum) OR absent(felix_int_dataplane_iface_msg_batch_size_count) OR (felix_int_dataplane_iface_msg_batch_size_sum/felix_int_dataplane_iface_msg_batch_size_count) > 5\n        for: 5m\n        labels:\n          severity: page\n        annotations:\n          description: "Felix instance {{ \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$labels")]),e._v(".instance }} has seen a high value of {{ \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$value")]),e._v(' }} dataplane interface message batch size"\n          summary: "Felix interface message batch size is higher"\n      - alert: calico_ipset_errors_high_1h\n        expr: absent(felix_ipset_errors) OR increase(felix_ipset_errors[1h]) > 5\n        labels:\n          severity: page\n        annotations:\n          description: "Felix instance {{ \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$labels")]),e._v(".instance }} has seen {{ \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$value")]),e._v(' }} ipset errors within the last hour"\n          summary: "A high number of ipset errors within Felix are happening"\n      - alert: calico_iptable_save_errors_high_1h\n        expr: absent(felix_iptables_save_errors) OR increase(felix_iptables_save_errors[1h]) > 5\n        labels:\n          severity: page\n        annotations:\n          description: "Felix instance {{ \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$labels")]),e._v(".instance }} has seen {{ \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$value")]),e._v(' }} iptable save errors within the last hour"\n          summary: "A high number of iptable save errors within Felix are happening"\n      - alert: calico_iptable_restore_errors_high_1h\n        expr: absent(felix_iptables_restore_errors) OR increase(felix_iptables_restore_errors[1h]) > 5\n        labels:\n          severity: page\n        annotations:\n          description: "Felix instance {{ \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$labels")]),e._v(".instance }} has seen {{ \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$value")]),e._v(' }} iptable restore errors within the last hour"\n          summary: "A high number of iptable restore errors within Felix are happening"\nalertmanager:\n  config:\n    global:\n      slack_api_url: '),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SLACK_INCOMING_WEBHOOK_URL}")]),e._v('\n      smtp_smarthost: "mailhog.mailhog.svc.cluster.local:1025"\n      smtp_from: "alertmanager@'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('"\n    route:\n      receiver: slack-notifications\n      group_by: ["alertname", "job"]\n      routes:\n        - match:\n            severity: warning\n          continue: true\n          receiver: slack-notifications\n        - match:\n            severity: warning\n          receiver: email-notifications\n    receivers:\n      - name: "email-notifications"\n        email_configs:\n        - to: "notification@'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('"\n          require_tls: false\n      - name: "slack-notifications"\n        slack_configs:\n          - channel: "#'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SLACK_CHANNEL}")]),e._v('"\n            send_resolved: True\n            icon_url: "https://avatars3.githubusercontent.com/u/3380462"\n            title: "{{ template '),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v("slack.cp.title"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v(' . }}"\n            text: "{{ template '),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v("slack.cp.text"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v(' . }}"\n            footer: "https://'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('"\n            actions:\n              - type: button\n                text: "Runbook :blue_book:"\n                url: "{{ (index .Alerts 0).Annotations.runbook_url }}"\n              - type: button\n                text: "Query :mag:"\n                url: "{{ (index .Alerts 0).GeneratorURL }}"\n              - type: button\n                text: "Silence :no_bell:"\n                url: "{{ template '),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v("__alert_silence_link"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v(' . }}"\n    templates:\n      - "/etc/alertmanager/config/cp-slack-templates.tmpl"\n  templateFiles:\n    cp-slack-templates.tmpl: |-\n      {{ define "slack.cp.title" -}}\n        [{{ .Status | toUpper -}}\n        {{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{- end -}}\n        ] {{ template "__alert_severity_prefix_title" . }} {{ .CommonLabels.alertname }}\n      {{- end }}\n      {{/* The test to display in the alert */}}\n      {{ define "slack.cp.text" -}}\n        {{ range .Alerts }}\n            *Alert:* {{ .Annotations.message}}\n            *Details:*\n            {{ range .Labels.SortedPairs }} - *{{ .Name }}:* \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" .Value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v('\n            {{ end }}\n            *-----*\n          {{ end }}\n      {{- end }}\n      {{ define "__alert_silence_link" -}}\n        {{ .ExternalURL }}/#/silences/new?filter=%7B\n        {{- range .CommonLabels.SortedPairs -}}\n          {{- if ne .Name "alertname" -}}\n            {{- .Name }}%3D"{{- .Value -}}"%2C%20\n          {{- end -}}\n        {{- end -}}\n          alertname%3D"{{ .CommonLabels.alertname }}"%7D\n      {{- end }}\n      {{ define "__alert_severity_prefix" -}}\n          {{ if ne .Status "firing" -}}\n          :white_check_mark:\n          {{- else if eq .Labels.severity "critical" -}}\n          :fire:\n          {{- else if eq .Labels.severity "warning" -}}\n          :warning:\n          {{- else -}}\n          :question:\n          {{- end }}\n      {{- end }}\n      {{ define "__alert_severity_prefix_title" -}}\n          {{ if ne .Status "firing" -}}\n          :white_check_mark:\n          {{- else if eq .CommonLabels.severity "critical" -}}\n          :fire:\n          {{- else if eq .CommonLabels.severity "warning" -}}\n          :warning:\n          {{- else if eq .CommonLabels.severity "info" -}}\n          :information_source:\n          {{- else if eq .CommonLabels.status_icon "information" -}}\n          :information_source:\n          {{- else -}}\n          :question:\n          {{- end }}\n      {{- end }}\n  ingress:\n    enabled: true\n    annotations:\n      nginx.ingress.kubernetes.io/auth-url: https://oauth2-proxy.'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/auth\n      nginx.ingress.kubernetes.io/auth-signin: https://oauth2-proxy."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/start?rd=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$scheme")]),e._v("://\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$host")]),e._v("\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$request_uri")]),e._v("\n    hosts:\n      - alertmanager."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('\n    paths: ["/"]\n    pathType: ImplementationSpecific\n    tls:\n      - secretName: ingress-cert-'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v("\n        hosts:\n          - alertmanager."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('\n  alertmanagerSpec:\n    storage:\n      volumeClaimTemplate:\n        spec:\n          storageClassName: gp3\n          accessModes: ["ReadWriteOnce"]\n          resources:\n            requests:\n              storage: 1Gi\n# https://github.com/grafana/helm-charts/blob/main/charts/grafana/values.yaml\ngrafana:\n  serviceAccount:\n    create: false\n    name: grafana\n  ingress:\n    enabled: true\n    annotations:\n      nginx.ingress.kubernetes.io/auth-url: https://oauth2-proxy.'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/auth\n      nginx.ingress.kubernetes.io/auth-signin: https://oauth2-proxy."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/start?rd=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$scheme")]),e._v("://\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$host")]),e._v("\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$request_uri")]),e._v("\n    hosts:\n      - grafana."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('\n    paths: ["/"]\n    pathType: ImplementationSpecific\n    tls:\n      - secretName: ingress-cert-'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v("\n        hosts:\n          - grafana."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\n  plugins:\n    - digiapulssi-breadcrumb-panel\n    - grafana-piechart-panel\n    # Needed for MySQL Instances Overview -> Table Openings details\n    - grafana-polystat-panel\n  env:\n    GF_AUTH_SIGV4_AUTH_ENABLED: true\n  datasources:\n    datasources.yaml:\n      apiVersion: 1\n      datasources:\n      - name: Loki\n        type: loki\n        access: proxy\n        url: http://loki.loki:3100\n      - name: CloudWatch\n        type: cloudwatch\n        jsonData:\n          defaultRegion: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AWS_DEFAULT_REGION}")]),e._v("\n      # Automated AMP provisioning as datasource does not work - needs to be done manually\n      - name: Amazon Managed Prometheus\n        type: prometheus\n        url: https://aps-workspaces."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AWS_DEFAULT_REGION}")]),e._v(".amazonaws.com/workspaces/"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AMP_WORKSPACE_ID}")]),e._v("\n        jsonData:\n          sigV4Auth: true\n          sigV4Region: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AWS_DEFAULT_REGION}")]),e._v('\n  dashboardProviders:\n    dashboardproviders.yaml:\n      apiVersion: 1\n      providers:\n        - name: "default"\n          orgId: 1\n          folder: ""\n          type: file\n          disableDeletion: false\n          editable: true\n          options:\n            path: /var/lib/grafana/dashboards/default\n  dashboards:\n    default:\n      k8s-cluster-summary:\n        gnetId: 8685\n        revision: 1\n        datasource: Prometheus\n      node-exporter-full:\n        gnetId: 1860\n        revision: 21\n        datasource: Prometheus\n      prometheus-2-0-overview:\n        gnetId: 3662\n        revision: 2\n        datasource: Prometheus\n      stians-disk-graphs:\n        gnetId: 9852\n        revision: 1\n        datasource: Prometheus\n      kubernetes-apiserver:\n        gnetId: 12006\n        revision: 1\n        datasource: Prometheus\n      ingress-nginx:\n        gnetId: 9614\n        revision: 1\n        datasource: Prometheus\n      ingress-nginx2:\n        gnetId: 11875\n        revision: 1\n        datasource: Prometheus\n      istio-mesh:\n        gnetId: 7639\n        revision: 54\n        datasource: Prometheus\n      istio-performance:\n        gnetId: 11829\n        revision: 54\n        datasource: Prometheus\n      istio-service:\n        gnetId: 7636\n        revision: 54\n        datasource: Prometheus\n      istio-workload:\n        gnetId: 7630\n        revision: 54\n        datasource: Prometheus\n      istio-control-plane:\n        gnetId: 7645\n        revision: 54\n        datasource: Prometheus\n      velero-stats:\n        gnetId: 11055\n        revision: 2\n        datasource: Prometheus\n      jaeger:\n        gnetId: 10001\n        revision: 2\n        datasource: Prometheus\n      loki-promtail:\n        gnetId: 10880\n        revision: 1\n        datasource: Prometheus\n      # https://github.com/fluxcd/flux2/blob/main/manifests/monitoring/grafana/dashboards/cluster.json\n      gitops-toolkit-control-plane:\n        url: https://raw.githubusercontent.com/fluxcd/flux2/9916a5376123b4bcdc0f11999a8f8781ce5ee78c/manifests/monitoring/grafana/dashboards/control-plane.json\n        datasource: Prometheus\n      gitops-toolkit-cluster:\n        url: https://raw.githubusercontent.com/fluxcd/flux2/344a909d19498f1f02b936882b529d84bbd460b8/manifests/monitoring/grafana/dashboards/cluster.json\n        datasource: Prometheus\n      kyverno-cluster-policy-report:\n        gnetId: 13996\n        revision: 3\n        datasource: Prometheus\n      kyverno-policy-report:\n        gnetId: 13995\n        revision: 3\n        datasource: Prometheus\n      kyverno-policy-reports:\n        gnetId: 13968\n        revision: 1\n        datasource: Prometheus\n      calico-felix-dashboard:\n        gnetId: 12175\n        revision: 5\n        datasource: Prometheus\n      harbor:\n        gnetId: 14075\n        revision: 2\n        datasource: Prometheus\n      aws-efs:\n        gnetId: 653\n        revision: 4\n        datasource: CloudWatch\n      amazon-rds-os-metrics:\n        gnetId: 702\n        revision: 1\n        datasource: CloudWatch\n      aws-rds:\n        gnetId: 707\n        revision: 5\n        datasource: CloudWatch\n      aws-rds-opt:\n        gnetId: 11698\n        revision: 1\n        datasource: CloudWatch\n      aws-ec2:\n        gnetId: 617\n        revision: 4\n        datasource: CloudWatch\n      aws-network-load-balancer:\n        gnetId: 12111\n        revision: 2\n        datasource: CloudWatch\n      aws-ebs:\n        gnetId: 623\n        revision: 4\n        datasource: CloudWatch\n      CPU_Utilization_Details:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/CPU_Utilization_Details.json\n        datasource: Prometheus\n      Disk_Details:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/Disk_Details.json\n        datasource: Prometheus\n      Memory_Details:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/Memory_Details.json\n        datasource: Prometheus\n      MySQL_Command_Handler_Counters_Compare:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/MySQL_Command_Handler_Counters_Compare.json\n        datasource: Prometheus\n      MySQL_InnoDB_Compression_Details:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/MySQL_InnoDB_Compression_Details.json\n        datasource: Prometheus\n      MySQL_InnoDB_Details:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/MySQL_InnoDB_Details.json\n        datasource: Prometheus\n      MySQL_Instance_Summary:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/MySQL_Instance_Summary.json\n        datasource: Prometheus\n      MySQL_Instances_Compare:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/MySQL_Instances_Compare.json\n        datasource: Prometheus\n      MySQL_Instances_Overview:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/MySQL_Instances_Overview.json\n        datasource: Prometheus\n      MySQL_MyISAM_Aria_Details:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/MySQL_MyISAM_Aria_Details.json\n        datasource: Prometheus\n      Network_Details:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/Network_Details.json\n        datasource: Prometheus\n      Nodes_Compare:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/Nodes_Compare.json\n        datasource: Prometheus\n      Nodes_Overview:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/Nodes_Overview.json\n        datasource: Prometheus\n      Prometheus_Exporters_Overview:\n        url: https://raw.githubusercontent.com/percona/grafana-dashboards/1316f80e834f9a3617e196b41617299c13d62421/dashboards/Prometheus_Exporters_Overview.json\n        datasource: Prometheus\n  grafana.ini:\n    server:\n      root_url: https://grafana.'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('\n    # Using oauth2-proxy instead of default Grafana Oauth\n    auth.anonymous:\n      enabled: true\n      org_role: Admin\n  smtp:\n    enabled: true\n    host: "mailhog.mailhog.svc.cluster.local:1025"\n    from_address: grafana@'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\nkubeControllerManager:\n  enabled: false\nkubeEtcd:\n  enabled: false\nkubeScheduler:\n  enabled: false\nkubeProxy:\n  enabled: false\nprometheusOperator:\n  tls:\n    enabled: false\n  admissionWebhooks:\n    enabled: false\nprometheus:\n  serviceAccount:\n    create: false\n    name: kube-prometheus-stack-prometheus\n  ingress:\n    enabled: true\n    annotations:\n      nginx.ingress.kubernetes.io/auth-url: https://oauth2-proxy."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/auth\n      nginx.ingress.kubernetes.io/auth-signin: https://oauth2-proxy."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/start?rd=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$scheme")]),e._v("://\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$host")]),e._v("\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$request_uri")]),e._v('\n    paths: ["/"]\n    pathType: ImplementationSpecific\n    hosts:\n      - prometheus.'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\n    tls:\n      - secretName: ingress-cert-"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v("\n        hosts:\n          - prometheus."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\n  prometheusSpec:\n    externalUrl: https://prometheus."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\n    ruleSelectorNilUsesHelmValues: false\n    podMonitorSelectorNilUsesHelmValues: false\n    retentionSize: 1GB\n    serviceMonitorSelectorNilUsesHelmValues: false\n    remoteWrite:\n      - url: http://localhost:8005/workspaces/"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AMP_WORKSPACE_ID}")]),e._v('/api/v1/remote_write\n    storageSpec:\n      volumeClaimTemplate:\n        spec:\n          storageClassName: gp3\n          accessModes: ["ReadWriteOnce"]\n          resources:\n            requests:\n              storage: 2Gi\n    containers:\n      - name: aws-sigv4-proxy-sidecar\n        image: public.ecr.aws/aws-observability/aws-sigv4-proxy:1.0\n        args:\n        - --name\n        - aps\n        - --region\n        - '),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AWS_DEFAULT_REGION}")]),e._v("\n        - --host\n        - aps-workspaces."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AWS_DEFAULT_REGION}")]),e._v(".amazonaws.com\n        - --port\n        - :8005\n        ports:\n        - name: aws-sigv4-proxy\n          containerPort: 8005\nEOF")]),e._v("\n")])])]),a("h2",{attrs:{id:"enable-calico-monitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enable-calico-monitoring"}},[e._v("#")]),e._v(" Enable calico monitoring")]),e._v(" "),a("blockquote",[a("p",[e._v("This step should be done right after Prometheus installation to prevent\nAlertmanager from firing calico related alarms")])]),e._v(" "),a("p",[e._v("Enable Felix Prometheus metrics:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("calicoctl --allow-version-mismatch patch felixConfiguration default "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--patch")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{'),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v("spec"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v(":{"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v("prometheusMetricsEnabled"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v(': true}}"')]),e._v("\n")])])]),a("p",[e._v("Creating a service to expose Felix metrics according\n"),a("a",{attrs:{href:"https://projectcalico.docs.tigera.io/maintenance/monitor/monitor-component-metrics",target:"_blank",rel:"noopener noreferrer"}},[e._v("Monitor Calico component metrics"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" - "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: felix-metrics-svc\n  namespace: kube-system\n  labels:\n    app: calico-felix\nspec:\n  selector:\n    k8s-app: calico-node\n  ports:\n  - name: metrics-http\n    port: 9091\n    targetPort: 9091\n---\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: felix-metrics-sm\n  namespace: kube-system\n  labels:\n    app: calico\nspec:\n  endpoints:\n  - interval: 10s\n    path: /metrics\n    port: metrics-http\n  namespaceSelector:\n    matchNames:\n    - kube-system\n  selector:\n    matchLabels:\n      app: calico-felix\nEOF")]),e._v("\n")])])]),a("p",[e._v("Creating a service to expose kube-controllers metrics:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" - "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-controllers-metrics-svc\n  namespace: kube-system\n  labels:\n    app: calico-kube-controllers\nspec:\n  selector:\n    k8s-app: calico-kube-controllers\n  ports:\n  - name: metrics-http\n    port: 9094\n    targetPort: 9094\n---\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: kube-controllers-metrics-sm\n  namespace: kube-system\nspec:\n  endpoints:\n  - interval: 10s\n    path: /metrics\n    port: metrics-http\n  namespaceSelector:\n    matchNames:\n    - kube-system\n  selector:\n    matchLabels:\n      app: calico-kube-controllers\nEOF")]),e._v("\n")])])]),a("h2",{attrs:{id:"loki"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loki"}},[e._v("#")]),e._v(" loki")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("loki")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/grafana/loki",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/grafana/helm-charts/blob/2657a57258bfcfec62a3a611209638a1ca2542ec/charts/loki/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update grafana https://grafana.github.io/helm-charts\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2.6")]),e._v(".0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" loki --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - loki grafana/loki "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nserviceMonitor:\n  enabled: true\nEOF")]),e._v("\n")])])]),a("p",[e._v("Install promtail to ingest logs to loki:")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("loki")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/grafana/promtail",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/grafana/helm-charts/blob/main/charts/promtail/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3.7")]),e._v(".0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" promtail --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - promtail grafana/promtail "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nserviceMonitor:\n  enabled: true\nconfig:\n  lokiAddress: http://loki-headless.loki:3100/loki/api/v1/push\nEOF")]),e._v("\n")])])]),a("h2",{attrs:{id:"aws-node-termination-handler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aws-node-termination-handler"}},[e._v("#")]),e._v(" aws-node-termination-handler")]),e._v(" "),a("p",[e._v("Install "),a("a",{attrs:{href:"https://github.com/aws/aws-node-termination-handler",target:"_blank",rel:"noopener noreferrer"}},[e._v("AWS Node Termination Handler"),a("OutboundLink")],1),e._v("\nwhich gracefully handle EC2 instance shutdown within Kubernetes.\nThis may happen when one of the K8s workers needs to be replaced by scheduling\nthe event: "),a("a",{attrs:{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/monitoring-instances-status-check_sched.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/monitoring-instances-status-check_sched.html"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("aws-node-termination-handler")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/aws/aws-node-termination-handler",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/aws/aws-node-termination-handler/blob/main/config/helm/aws-node-termination-handler/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.15")]),e._v(".2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" kube-system --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - aws-node-termination-handler eks/aws-node-termination-handler "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nenableRebalanceMonitoring: true\nawsRegion: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AWS_DEFAULT_REGION}")]),e._v("\nenableSpotInterruptionDraining: true\nenableScheduledEventDraining: true\ndeleteLocalData: true\npodMonitor:\n  create: true\nEOF")]),e._v("\n")])])]),a("h2",{attrs:{id:"kyverno"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kyverno"}},[e._v("#")]),e._v(" kyverno")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("kyverno")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/kyverno/kyverno",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/kyverno/kyverno/blob/main/charts/kyverno/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update kyverno https://kyverno.github.io/kyverno/\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" v1.4.2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" kyverno --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - kyverno kyverno/kyverno "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nhostNetwork: true\nEOF")]),e._v("\n")])])]),a("p",[e._v("Install "),a("code",[e._v("policy-reporter")]),e._v(" "),a("a",{attrs:{href:"https://github.com/fjogeleit/policy-reporter/tree/main/charts/policy-reporter",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/fjogeleit/policy-reporter/blob/main/charts/policy-reporter/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update policy-reporter https://fjogeleit.github.io/policy-reporter\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.8")]),e._v(".6 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" policy-reporter --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - policy-reporter policy-reporter/policy-reporter "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nui:\n  enabled: true\n  ingress:\n    enabled: true\n    annotations:\n      nginx.ingress.kubernetes.io/auth-url: https://oauth2-proxy."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/auth\n      nginx.ingress.kubernetes.io/auth-signin: https://oauth2-proxy."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/start?rd=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$scheme")]),e._v("://\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$host")]),e._v("\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$request_uri")]),e._v("\n    hosts:\n      - host: policy-reporter."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('\n        paths: ["/"]\n    tls:\n      - secretName: ingress-cert-'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v("\n        hosts:\n          - policy-reporter."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('\nmonitoring:\n  enabled: true\n  namespace: default\ntarget:\n  loki:\n    host: http://loki-headless.loki:3100\n    minimumPriority: "info"\n    skipExistingOnStartup: true\n  slack:\n    webhook: "'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SLACK_INCOMING_WEBHOOK_URL}")]),e._v('"\n    minimumPriority: "warning"\n    skipExistingOnStartup: true\nEOF')]),e._v("\n")])])]),a("p",[e._v("Install kyverno policies:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-pv")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"tmp/'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('/kyverno-policies"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"tmp/'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('/kyverno-policies/kustomization.yaml"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nresources:\n- github.com/kyverno/policies/pod-security?ref=930b579b1d81be74678045dd3d397f668d321cdf\npatches:\n  - patch: |-\n      - op: replace\n        path: /spec/validationFailureAction\n        value: audit\n    target:\n      kind: ClusterPolicy\nEOF")]),e._v("\nkustomize build "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"tmp/'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('/kyverno-policies"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" -\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("30")]),e._v("\n")])])]),a("p",[e._v("Check if all policies are in place in "),a("code",[e._v("audit")]),e._v(" mode:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get clusterpolicies.kyverno.io\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                             BACKGROUND   ACTION\ndeny-privilege-escalation        true         audit\ndisallow-add-capabilities        true         audit\ndisallow-host-namespaces         true         audit\ndisallow-host-path               true         audit\ndisallow-host-ports              true         audit\ndisallow-privileged-containers   true         audit\ndisallow-selinux                 true         audit\nrequire-default-proc-mount       true         audit\nrequire-non-root-groups          true         audit\nrequire-run-as-non-root          true         audit\nrestrict-apparmor-profiles       true         audit\nrestrict-seccomp                 true         audit\nrestrict-sysctls                 true         audit\nrestrict-volume-types            true         audit\n")])])]),a("p",[e._v("Viewing policy report summaries")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get policyreport "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-A")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAMESPACE               NAME                            PASS   FAIL   WARN   ERROR   SKIP   AGE\namazon-cloudwatch       polr-ns-amazon-cloudwatch       39     5      0      0       0      23s\nkube-prometheus-stack   polr-ns-kube-prometheus-stack   220    14     0      0       0      21s\nloki                    polr-ns-loki                    37     1      0      0       0      16s\npolicy-reporter         polr-ns-policy-reporter         76     0      0      0       0      18s\npromtail                polr-ns-promtail                38     6      0      0       0      25s\n")])])]),a("p",[e._v("Viewing policy violations:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl describe policyreport "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" amazon-cloudwatch polr-ns-amazon-cloudwatch "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Status: \\+fail"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-B10")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("  Policy:         disallow-host-path\n  Resources:\n    API Version:  v1\n    Kind:         Pod\n    Name:         aws-cloudwatch-metrics-wxzrl\n    Namespace:    amazon-cloudwatch\n    UID:          350f1d9e-8924-40fd-a53e-5cebf7c93e6a\n  Rule:           host-path\n  Scored:         true\n  Severity:       medium\n  Status:         fail\n--\n  Policy:         disallow-host-path\n  Resources:\n    API Version:  apps/v1\n    Kind:         DaemonSet\n    Name:         aws-cloudwatch-metrics\n    Namespace:    amazon-cloudwatch\n    UID:          436a3635-ec5a-4a35-85e8-48f0922091e0\n  Rule:           autogen-host-path\n  Scored:         true\n  Severity:       medium\n  Status:         fail\n--\n  Policy:         disallow-host-path\n  Resources:\n    API Version:  v1\n    Kind:         Pod\n    Name:         aws-cloudwatch-metrics-5klqf\n    Namespace:    amazon-cloudwatch\n    UID:          911e66b4-1e58-4f30-aff4-64f6779a06c8\n  Rule:           host-path\n  Scored:         true\n  Severity:       medium\n  Status:         fail\n--\n  Message:        validation error: Running as root is not allowed. The fields spec.securityContext.runAsNonRoot, spec.containers[*].securityContext.runAsNonRoot, and spec.initContainers[*].securityContext.runAsNonRoot must be `true`. Rule autogen-check-containers[0] failed at path /spec/template/spec/securityContext/runAsNonRoot/. Rule autogen-check-containers[1] failed at path /spec/template/spec/containers/0/securityContext/.\n  Policy:         require-run-as-non-root\n  Resources:\n    API Version:  apps/v1\n    Kind:         DaemonSet\n    Name:         aws-cloudwatch-metrics\n    Namespace:    amazon-cloudwatch\n    UID:          436a3635-ec5a-4a35-85e8-48f0922091e0\n  Rule:           autogen-check-containers\n  Scored:         true\n  Status:         fail\n--\n  Policy:         disallow-host-path\n  Resources:\n    API Version:  v1\n    Kind:         Pod\n    Name:         aws-cloudwatch-metrics-tm2vl\n    Namespace:    amazon-cloudwatch\n    UID:          17238c4c-1f90-4ac5-ab1d-6429a6e102f0\n  Rule:           host-path\n  Scored:         true\n  Severity:       medium\n  Status:         fail\n")])])]),a("p",[e._v("Create ClusterPolicy to check if "),a("code",[e._v("team_name")]),e._v(" label is present in namespaces:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" - "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("EOF\napiVersion: kyverno.io/v1\nkind: ClusterPolicy\nmetadata:\n  name: require-ns-labels\nspec:\n  validationFailureAction: audit\n  background: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n  rules:\n  - name: check-for-labels-on-namespace\n    match:\n      resources:\n        kinds:\n        - Namespace\n    validate:\n      message: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"The label '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")]),e._v("team_name"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("`")])]),e._v(' is required."')]),e._v("\n      pattern:\n        metadata:\n          labels:\n            team_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"?*"')]),e._v("\nEOF\n")])])]),a("p",[e._v("See the results:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get clusterpolicyreport\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                  PASS   FAIL   WARN   ERROR   SKIP   AGE\nclusterpolicyreport   0      9      0      0       0      129m\n")])])]),a("h2",{attrs:{id:"nri-bundle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nri-bundle"}},[e._v("#")]),e._v(" nri-bundle")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("nri-bundle")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/newrelic/nri-bundle",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/newrelic/helm-charts/blob/master/charts/nri-bundle/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update newrelic https://helm-charts.newrelic.com\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2.8")]),e._v(".1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" nri-bundle --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - nri-bundle newrelic/nri-bundle "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nprometheus:\n  enabled: true\nkubeEvents:\n  enabled: true\nlogging:\n  enabled: true\nglobal:\n  licenseKey: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${NEW_RELIC_LICENSE_KEY}")]),e._v("\n  cluster: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\nEOF")]),e._v("\n")])])]),a("h2",{attrs:{id:"splunk-connect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#splunk-connect"}},[e._v("#")]),e._v(" splunk-connect")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("splunk-connect")]),e._v(" "),a("a",{attrs:{href:"https://github.com/splunk/splunk-connect-for-kubernetes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/splunk/splunk-connect-for-kubernetes/blob/develop/helm-chart/splunk-connect-for-kubernetes/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update splunk https://splunk.github.io/splunk-connect-for-kubernetes/\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.4")]),e._v(".7 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" splunk-connect --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - splunk-connect splunk/splunk-connect-for-kubernetes "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nglobal:\n  splunk:\n    hec:\n      host: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SPLUNK_HOST}")]),e._v("\n      token: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SPLUNK_TOKEN}")]),e._v("\n      indexName: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SPLUNK_INDEX_NAME}")]),e._v("\n  kubernetes:\n    clusterName: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\n  prometheus_enabled: true\n  monitoring_agent_enabled: true\nEOF")]),e._v("\n")])])]),a("h2",{attrs:{id:"aqua-security-enforcer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aqua-security-enforcer"}},[e._v("#")]),e._v(" Aqua Security Enforcer")]),e._v(" "),a("p",[e._v("Both "),a("code",[e._v("aqua-enforcer")]),e._v(" and "),a("code",[e._v("kube-enforcer")]),e._v(" needs to be installed.")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("aqua-enforcer")]),e._v(" "),a("a",{attrs:{href:"https://github.com/aquasecurity/aqua-helm/tree/5.3/enforcer",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/aquasecurity/aqua-helm/blob/6.2/enforcer/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v("\nand "),a("a",{attrs:{href:"https://github.com/aquasecurity/aqua-helm/blob/6.2/kube-enforcer/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update aqua-helm https://helm.aquasec.com\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("6.2")]),e._v(".5 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" aqua --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - aqua-enforcer aqua-helm/enforcer "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('EOF\nimageCredentials:\n  create: true\n  username: "'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AQUA_REGISTRY_USERNAME}")]),e._v('"\n  password: "'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AQUA_REGISTRY_PASSWORD}")]),e._v('"\nserviceAccount:\n  create: true\nenforcerToken: "'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AQUA_ENFORCER_TOKEN}")]),e._v('"\nenforcerLogicalName: '),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("USER")]),e._v("}")]),e._v('-test\nextraEnvironmentVars:\n  CLUSTER_NAME: "'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("USER")]),e._v("}")]),e._v('-test"\ngate:\n  host: "'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AQUA_GATE_HOST}")]),e._v('"\n  port: 443\nEOF')]),e._v("\n\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("6.2")]),e._v(".4 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" aqua "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - kube-enforcer aqua-helm/kube-enforcer "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nimageCredentials:\n  create: false\ncertsSecret:\n  create: true\n  # name: aqua-kube-enforcer-certs # If you're using existing certs change the name to existing secret name\n  serverCertificate: LS0tL...0tLQo=\n  serverKey: LS0tL...0tLQo=\naquaSecret:\n  kubeEnforcerToken: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AQUA_KUBE_ENFORCER_TOKEN}")]),e._v("\nwebhooks:\n  caBundle: LS...0tLQo=\nenvs:\n  gatewayAddress: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AQUA_GATE_HOST}")]),e._v(':443\nextraEnvironmentVars:\n  CLUSTER_NAME: "'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("USER")]),e._v("}")]),e._v('-test"\nEOF')]),e._v("\n")])])]),a("h2",{attrs:{id:"sysdig-agent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sysdig-agent"}},[e._v("#")]),e._v(" sysdig-agent")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("sysdig-agent")]),e._v(" "),a("a",{attrs:{href:"https://github.com/sysdiglabs/charts/tree/master/charts/sysdig",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/sysdiglabs/charts/blob/master/charts/sysdig/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update sysdig https://charts.sysdig.com\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.11")]),e._v(".11 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" sysdig-agent --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - sysdig-agent sysdig/sysdig "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nsysdig:\n  accessKey: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${SYSDIG_AGENT_ACCESSKEY}")]),e._v("\n  settings:\n    collector: ingest-eu1.app.sysdig.com\n    k8s_cluster_name: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\n    prometheus:\n      enabled: true\n      histograms: true\nauditLog:\n  enabled: true\nEOF")]),e._v("\n")])])]),a("p",[e._v("Integrate the Kubernetes Audit facility with Sysdig Secure by enabling\nCloudWatch audit logs for Sysdig "),a("a",{attrs:{href:"https://github.com/sysdiglabs/ekscloudwatch",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/sysdiglabs/ekscloudwatch"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("p",[e._v('As a "quick and dirty" to make '),a("code",[e._v("sysdig-eks-cloudwatch")]),e._v(" running you need to add\n"),a("code",[e._v("CloudWatchReadOnlyAccess")]),e._v(" policy to "),a("code",[e._v("eksctl-kube1-nodegroup-ng01-NodeInstanceRole")]),e._v("\nrole. This should be done better using "),a("a",{attrs:{href:"https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/setting-up-enable-IAM.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("IRSA"),a("OutboundLink")],1),e._v("\nbut this is enough for non-prod tests...")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" sysdig-agent apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" https://raw.githubusercontent.com/sysdiglabs/ekscloudwatch/master/ekscloudwatch-config.yaml\nkubectl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" sysdig-agent apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" https://raw.githubusercontent.com/sysdiglabs/ekscloudwatch/master/deployment.yaml\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);