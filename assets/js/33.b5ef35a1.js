(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{320:function(e,a,t){"use strict";t.r(a);var s=t(8),n=Object(s.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"velero"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#velero"}},[e._v("#")]),e._v(" Velero")]),e._v(" "),a("p",[e._v("Velero helps with backup/restore of Kubernetes objects.")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("velero")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/vmware-tanzu/velero",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/vmware-tanzu/helm-charts/blob/main/charts/velero/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update vmware-tanzu https://vmware-tanzu.github.io/helm-charts\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2.23")]),e._v(".5 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" velero --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - velero vmware-tanzu/velero "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\ninitContainers:\n  - name: velero-plugin-for-aws\n    image: velero/velero-plugin-for-aws:v1.2.0\n    imagePullPolicy: Always\n    volumeMounts:\n      - mountPath: /target\n        name: plugins\n  - name: velero-plugin-for-csi\n    image: velero/velero-plugin-for-csi:v0.1.2\n    imagePullPolicy: Always\n    volumeMounts:\n      - mountPath: /target\n        name: plugins\nmetrics:\n  serviceMonitor:\n    enabled: true\nconfiguration:\n  provider: aws\n  backupStorageLocation:\n    bucket: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\n    prefix: velero\n    config:\n      region: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AWS_DEFAULT_REGION}")]),e._v("\n  volumeSnapshotLocation:\n    name: aws\n    config:\n      region: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AWS_DEFAULT_REGION}")]),e._v("\n  features: EnableCSI\nserviceAccount:\n  server:\n    create: false\n    name: velero\ncredentials:\n  useSecret: false\ndeployRestic: true\nEOF")]),e._v("\n")])])]),a("h2",{attrs:{id:"backup-vault-using-csi-volume-snapshotting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backup-vault-using-csi-volume-snapshotting"}},[e._v("#")]),e._v(" Backup Vault using CSI Volume Snapshotting")]),e._v(" "),a("p",[e._v("This example showing Velero backup using snapshots "),a("code",[e._v("features: EnableCSI")]),e._v(":")]),e._v(" "),a("p",[e._v("Run backup of "),a("code",[e._v("vault")]),e._v(" namespace:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("velero backup create backup-vault "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--ttl")]),e._v(" 24h --include-namespaces"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("vault "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--wait")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Backup request "backup-vault" submitted successfully.\nWaiting for backup to complete. You may safely press ctrl-c to stop waiting - your backup will continue in the background.\n.............................\nBackup completed with status: Completed. You may check for more information using the commands `velero backup describe backup-vault` and `velero backup logs backup-vault`.\n')])])]),a("p",[e._v("Check the backups:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("velero get backups\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME           STATUS      ERRORS   WARNINGS   CREATED                         EXPIRES   STORAGE LOCATION   SELECTOR\nbackup-vault   Completed   0        0          2021-11-29 19:35:48 +0100 CET   23h       default            &lt;none>\n")])])]),a("p",[e._v("See the details of the "),a("code",[e._v("backup-vault")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("velero backup describe backup-vault "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--details")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--features")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("EnableCSI\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Name:         backup-vault\nNamespace:    velero\nLabels:       velero.io/storage-location=default\nAnnotations:  velero.io/source-cluster-k8s-gitversion=v1.21.2-eks-06eac09\n              velero.io/source-cluster-k8s-major-version=1\n              velero.io/source-cluster-k8s-minor-version=21+\n\nPhase:  Completed\n\nErrors:    0\nWarnings:  0\n\nNamespaces:\n  Included:  vault\n  Excluded:  &lt;none>\n\nResources:\n  Included:        *\n  Excluded:        &lt;none>\n  Cluster-scoped:  auto\n\nLabel selector:  &lt;none>\n\nStorage Location:  default\n\nVelero-Native Snapshot PVs:  auto\n\nTTL:  24h0m0s\n\nHooks:  &lt;none>\n\nBackup Format Version:  1.1.0\n\nStarted:    2021-11-29 19:35:48 +0100 CET\nCompleted:  2021-11-29 19:36:13 +0100 CET\n\nExpiration:  2021-11-30 19:35:47 +0100 CET\n\nTotal items to be backed up:  50\nItems backed up:              50\n\nResource List:\n  apiextensions.k8s.io/v1/CustomResourceDefinition:\n    - apps.catalog.cattle.io\n    - policyreports.wgpolicyk8s.io\n  apps/v1/ControllerRevision:\n    - vault/vault-5d64bdf4c\n  apps/v1/StatefulSet:\n    - vault/vault\n  catalog.cattle.io/v1/App:\n    - vault/vault\n  discovery.k8s.io/v1/EndpointSlice:\n    - vault/vault-internal-jmw6b\n    - vault/vault-k4bsj\n  extensions/v1beta1/Ingress:\n    - vault/vault\n  networking.k8s.io/v1/Ingress:\n    - vault/vault\n  rbac.authorization.k8s.io/v1/ClusterRole:\n    - system:auth-delegator\n  rbac.authorization.k8s.io/v1/ClusterRoleBinding:\n    - vault-server-binding\n  snapshot.storage.k8s.io/v1/VolumeSnapshot:\n    - vault/velero-data-vault-0-tjzmn\n  snapshot.storage.k8s.io/v1/VolumeSnapshotClass:\n    - csi-ebs-snapclass\n  snapshot.storage.k8s.io/v1/VolumeSnapshotContent:\n    - snapcontent-4590ab05-9985-46d1-b933-9ac6cbf8f273\n  v1/ConfigMap:\n    - vault/istio-ca-root-cert\n    - vault/kube-root-ca.crt\n    - vault/vault-config\n  v1/Endpoints:\n    - vault/vault\n    - vault/vault-internal\n  v1/Event:\n    - vault/data-vault-0.16bc16518e27caa7\n    - vault/data-vault-0.16bc1651a2cec15e\n    - vault/data-vault-0.16bc1651a472319d\n    - vault/data-vault-0.16bc165276a2e75e\n    - vault/vault-0.16bc16528ff1897e\n    - vault/vault-0.16bc1653507ef368\n    - vault/vault-0.16bc1655a8f8ba2c\n    - vault/vault-0.16bc1657c6ec0ccf\n    - vault/vault-0.16bc1657d8e90a9b\n    - vault/vault-0.16bc1657e8e0c068\n    - vault/vault-0.16bc16599ccee60e\n    - vault/vault.16bc16517c637f61\n    - vault/vault.16bc16518e5caae2\n    - vault/vault.16bc16519b84095f\n    - vault/vault.16bc16519cec3f09\n    - vault/vault.16bc16677d87006d\n    - vault/vault.16bc181570c799e4\n    - vault/vault.16bc1825c7e610bc\n  v1/Namespace:\n    - vault\n  v1/PersistentVolume:\n    - pvc-7c542be7-2c63-4c44-9634-19ac2f1b291c\n  v1/PersistentVolumeClaim:\n    - vault/data-vault-0\n  v1/Pod:\n    - vault/vault-0\n  v1/Secret:\n    - vault/default-token-vbfds\n    - vault/ingress-cert-staging\n    - vault/sh.helm.release.v1.vault.v1\n    - vault/vault-token-v7px6\n  v1/Service:\n    - vault/vault\n    - vault/vault-internal\n  v1/ServiceAccount:\n    - vault/default\n    - vault/vault\n  wgpolicyk8s.io/v1alpha1/PolicyReport:\n    - vault/polr-ns-vault\n\nVelero-Native Snapshots: &lt;none included>\n\nCSI Volume Snapshots:\nSnapshot Content Name: snapcontent-4590ab05-9985-46d1-b933-9ac6cbf8f273\n  Storage Snapshot ID: snap-00bbc8da2281aeac8\n  Snapshot Size (bytes): 1073741824\n  Ready to use: true\n")])])]),a("p",[e._v("List all the "),a("code",[e._v("VolumeSnapshot")]),e._v(" objects:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get volumesnapshots --all-namespaces\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAMESPACE   NAME                        READYTOUSE   SOURCEPVC      SOURCESNAPSHOTCONTENT   RESTORESIZE   SNAPSHOTCLASS       SNAPSHOTCONTENT                                    CREATIONTIME   AGE\nvault       velero-data-vault-0-tjzmn   true         data-vault-0                           1Gi           csi-ebs-snapclass   snapcontent-4590ab05-9985-46d1-b933-9ac6cbf8f273   9s             10s\n")])])]),a("p",[e._v("Check the "),a("code",[e._v("VolumeSnapshot")]),e._v(" details:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl describe volumesnapshots "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" vault\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Name:         velero-data-vault-0-tjzmn\nNamespace:    vault\nLabels:       velero.io/backup-name=backup-vault\nAnnotations:  &lt;none>\nAPI Version:  snapshot.storage.k8s.io/v1\nKind:         VolumeSnapshot\nMetadata:\n  Creation Timestamp:  2021-11-29T18:36:08Z\n  Finalizers:\n    snapshot.storage.kubernetes.io/volumesnapshot-as-source-protection\n  Generate Name:  velero-data-vault-0-\n  Generation:     1\n  Managed Fields:\n    API Version:  snapshot.storage.k8s.io/v1beta1\n    Fields Type:  FieldsV1\n    fieldsV1:\n      f:metadata:\n        f:generateName:\n        f:labels:\n          .:\n          f:velero.io/backup-name:\n      f:spec:\n        .:\n        f:source:\n          .:\n          f:persistentVolumeClaimName:\n        f:volumeSnapshotClassName:\n    Manager:      velero-plugin-for-csi\n    Operation:    Update\n    Time:         2021-11-29T18:36:08Z\n    API Version:  snapshot.storage.k8s.io/v1\n    Fields Type:  FieldsV1\n    fieldsV1:\n      f:metadata:\n        f:finalizers:\n          .:\n          v:"snapshot.storage.kubernetes.io/volumesnapshot-as-source-protection":\n      f:status:\n        .:\n        f:boundVolumeSnapshotContentName:\n        f:creationTime:\n        f:readyToUse:\n        f:restoreSize:\n    Manager:         snapshot-controller\n    Operation:       Update\n    Time:            2021-11-29T18:36:09Z\n  Resource Version:  58212\n  UID:               4590ab05-9985-46d1-b933-9ac6cbf8f273\nSpec:\n  Source:\n    Persistent Volume Claim Name:  data-vault-0\n  Volume Snapshot Class Name:      csi-ebs-snapclass\nStatus:\n  Bound Volume Snapshot Content Name:  snapcontent-4590ab05-9985-46d1-b933-9ac6cbf8f273\n  Creation Time:                       2021-11-29T18:36:09Z\n  Ready To Use:                        true\n  Restore Size:                        1Gi\nEvents:\n  Type    Reason            Age   From                 Message\n  ----    ------            ----  ----                 -------\n  Normal  CreatingSnapshot  11s   snapshot-controller  Waiting for a snapshot vault/velero-data-vault-0-tjzmn to be created by the CSI driver.\n  Normal  SnapshotCreated   10s   snapshot-controller  Snapshot vault/velero-data-vault-0-tjzmn was successfully created by the CSI driver.\n  Normal  SnapshotReady     5s    snapshot-controller  Snapshot vault/velero-data-vault-0-tjzmn is ready to use.\n')])])]),a("p",[e._v("Get the "),a("code",[e._v("VolumeSnapshotContent")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get volumesnapshotcontent\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                                               READYTOUSE   RESTORESIZE   DELETIONPOLICY   DRIVER            VOLUMESNAPSHOTCLASS   VOLUMESNAPSHOT              VOLUMESNAPSHOTNAMESPACE   AGE\nsnapcontent-4590ab05-9985-46d1-b933-9ac6cbf8f273   true         1073741824    Retain           ebs.csi.aws.com   csi-ebs-snapclass     velero-data-vault-0-tjzmn   vault                     12s\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl describe volumesnapshotcontent "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("kubectl get volumesnapshotcontent "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{.items[*].metadata.name}"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v('"')]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Name:         snapcontent-4590ab05-9985-46d1-b933-9ac6cbf8f273\nNamespace:\nLabels:       velero.io/backup-name=backup-vault\nAnnotations:  &lt;none>\nAPI Version:  snapshot.storage.k8s.io/v1\nKind:         VolumeSnapshotContent\nMetadata:\n  Creation Timestamp:  2021-11-29T18:36:08Z\n  Finalizers:\n    snapshot.storage.kubernetes.io/volumesnapshotcontent-bound-protection\n  Generation:  1\n  Managed Fields:\n    API Version:  snapshot.storage.k8s.io/v1\n    Fields Type:  FieldsV1\n    fieldsV1:\n      f:metadata:\n        f:finalizers:\n          .:\n          v:"snapshot.storage.kubernetes.io/volumesnapshotcontent-bound-protection":\n      f:spec:\n        .:\n        f:deletionPolicy:\n        f:driver:\n        f:source:\n          .:\n          f:volumeHandle:\n        f:volumeSnapshotClassName:\n        f:volumeSnapshotRef:\n          .:\n          f:apiVersion:\n          f:kind:\n          f:name:\n          f:namespace:\n          f:resourceVersion:\n          f:uid:\n    Manager:      snapshot-controller\n    Operation:    Update\n    Time:         2021-11-29T18:36:08Z\n    API Version:  snapshot.storage.k8s.io/v1beta1\n    Fields Type:  FieldsV1\n    fieldsV1:\n      f:status:\n        .:\n        f:creationTime:\n        f:readyToUse:\n        f:restoreSize:\n        f:snapshotHandle:\n    Manager:      csi-snapshotter\n    Operation:    Update\n    Time:         2021-11-29T18:36:12Z\n    API Version:  snapshot.storage.k8s.io/v1beta1\n    Fields Type:  FieldsV1\n    fieldsV1:\n      f:metadata:\n        f:labels:\n          .:\n          f:velero.io/backup-name:\n    Manager:         velero-plugin-for-csi\n    Operation:       Update\n    Time:            2021-11-29T18:36:13Z\n  Resource Version:  58204\n  UID:               ac2e744b-a973-43f7-94f2-0a19e96fbded\nSpec:\n  Deletion Policy:  Retain\n  Driver:           ebs.csi.aws.com\n  Source:\n    Volume Handle:             vol-02eaf309a1814296b\n  Volume Snapshot Class Name:  csi-ebs-snapclass\n  Volume Snapshot Ref:\n    API Version:       snapshot.storage.k8s.io/v1\n    Kind:              VolumeSnapshot\n    Name:              velero-data-vault-0-tjzmn\n    Namespace:         vault\n    Resource Version:  58099\n    UID:               4590ab05-9985-46d1-b933-9ac6cbf8f273\nStatus:\n  Creation Time:    1638210969214000000\n  Ready To Use:     true\n  Restore Size:     1073741824\n  Snapshot Handle:  snap-00bbc8da2281aeac8\nEvents:             &lt;none>\n')])])]),a("p",[e._v("Check the snapshots in AWS:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("aws ec2 describe-snapshots "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--filter")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Name=tag:kubernetes.io/cluster/'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v(',Values=owned"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" jq\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Snapshots"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Description"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Created by AWS EBS CSI driver for volume vol-011280587cf55688f"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Encrypted"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"KmsKeyId"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"arn:aws:kms:eu-central-1:7xxxxxxxxxx7:key/a753d4d9-5006-4bea-8351-34092cd7b34e"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"OwnerId"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"7xxxxxxxxxx7"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Progress"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"99%"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"SnapshotId"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"snap-0203474147721b8f6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"StartTime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2021-03-20T09:33:18.023000+00:00"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"State"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"pending"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"VolumeId"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"vol-011280587cf55688f"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"VolumeSize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Tags"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"CSIVolumeSnapshotName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Value"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"snapshot-99d118b4-ff11-4a3b-b1cf-c641ce4c034c"')]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"kubernetes.io/cluster/kube1.k8s.mylabs.dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Value"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"owned"')]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[e._v('"Value"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"kube1.k8s.mylabs.dev-dynamic-snapshot-99d118b4-ff11-4a3b-b1cf-c641ce4c034c"')]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("See the files in S3 bucket:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("aws s3 "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--recursive")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"s3://'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('/velero/"')]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("2021-11-29 19:36:14        740 velero/backups/backup-vault/backup-vault-csi-volumesnapshotcontents.json.gz\n2021-11-29 19:36:14        539 velero/backups/backup-vault/backup-vault-csi-volumesnapshots.json.gz\n2021-11-29 19:36:14       8189 velero/backups/backup-vault/backup-vault-logs.gz\n2021-11-29 19:36:14         29 velero/backups/backup-vault/backup-vault-podvolumebackups.json.gz\n2021-11-29 19:36:14        772 velero/backups/backup-vault/backup-vault-resource-list.json.gz\n2021-11-29 19:36:14         29 velero/backups/backup-vault/backup-vault-volumesnapshots.json.gz\n2021-11-29 19:36:14     180977 velero/backups/backup-vault/backup-vault.tar.gz\n2021-11-29 19:36:14       2089 velero/backups/backup-vault/velero-backup.json\n")])])]),a("h2",{attrs:{id:"delete-restore-vault-using-csi-volume-snapshotting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#delete-restore-vault-using-csi-volume-snapshotting"}},[e._v("#")]),e._v(" Delete + Restore Vault using CSI Volume Snapshotting")]),e._v(" "),a("p",[e._v("Check the "),a("code",[e._v("vault")]),e._v(" namespace and it's objects:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get pods,deployments,services,ingress,secrets,pvc,statefulset,service,configmap "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" vault\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME          READY   STATUS    RESTARTS   AGE\npod/vault-0   1/1     Running   0          34m\n\nNAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE\nservice/vault            ClusterIP   10.100.171.190   &lt;none>        8200/TCP,8201/TCP   34m\nservice/vault-internal   ClusterIP   None             &lt;none>        8200/TCP,8201/TCP   34m\n\nNAME                              CLASS    HOSTS                        ADDRESS                                                                         PORTS     AGE\ningress.networking.k8s.io/vault   &lt;none>   vault.kube1.k8s.mylabs.dev   a3eb1591c3e6146ef99ccb15b1f35f50-fb80a50b84de3021.elb.eu-west-1.amazonaws.com   80, 443   34m\n\nNAME                                 TYPE                                  DATA   AGE\nsecret/default-token-vbfds           kubernetes.io/service-account-token   3      77m\nsecret/ingress-cert-staging          kubernetes.io/tls                     2      61m\nsecret/sh.helm.release.v1.vault.v1   helm.sh/release.v1                    1      34m\nsecret/vault-token-v7px6             kubernetes.io/service-account-token   3      77m\n\nNAME                                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npersistentvolumeclaim/data-vault-0   Bound    pvc-7c542be7-2c63-4c44-9634-19ac2f1b291c   1Gi        RWO            gp3            34m\n\nNAME                     READY   AGE\nstatefulset.apps/vault   1/1     34m\n\nNAME                           DATA   AGE\nconfigmap/istio-ca-root-cert   1      58m\nconfigmap/kube-root-ca.crt     1      77m\nconfigmap/vault-config         1      34m\n")])])]),a("p",[e._v("Remove "),a("code",[e._v("vault")]),e._v(" namespace - simulate unfortunate deletion of namespace:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl delete namespace vault\n")])])]),a("p",[e._v("Restore namespace `vault:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("velero restore create restore-vault --from-backup backup-vault --include-namespaces vault "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--wait")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Restore request "restore-vault" submitted successfully.\nWaiting for restore to complete. You may safely press ctrl-c to stop waiting - your restore will continue in the background.\n....\nRestore completed with status: Completed. You may check for more information using the commands `velero restore describe restore-vault` and `velero restore logs restore-vault`.\n')])])]),a("p",[e._v("Get recovery list:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("velero restore get\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME            BACKUP         STATUS      STARTED                         COMPLETED                       ERRORS   WARNINGS   CREATED                         SELECTOR\nrestore-vault   backup-vault   Completed   2021-11-29 19:36:47 +0100 CET   2021-11-29 19:36:51 +0100 CET   0        1          2021-11-29 19:36:46 +0100 CET   &lt;none>\n")])])]),a("p",[e._v("Get the details about recovery:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("velero restore describe restore-vault\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("wait")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" vault "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--for")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("condition"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("Ready "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("5m pod vault-0\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Name:         restore-vault\nNamespace:    velero\nLabels:       &lt;none>\nAnnotations:  &lt;none>\n\nPhase:                       Completed\nTotal items to be restored:  26\nItems restored:              26\n\nStarted:    2021-11-29 19:36:47 +0100 CET\nCompleted:  2021-11-29 19:36:51 +0100 CET\n\nWarnings:\n  Velero:     &lt;none>\n  Cluster:    &lt;none>\n  Namespaces:\n    vault:  could not restore, apps.catalog.cattle.io "vault" already exists. Warning: the in-cluster version is different than the backed-up version.\n\nBackup:  backup-vault\n\nNamespaces:\n  Included:  vault\n  Excluded:  &lt;none>\n\nResources:\n  Included:        *\n  Excluded:        nodes, events, events.events.k8s.io, backups.velero.io, restores.velero.io, resticrepositories.velero.io\n  Cluster-scoped:  auto\n\nNamespace mappings:  &lt;none>\n\nLabel selector:  &lt;none>\n\nRestore PVs:  auto\n\nPreserve Service NodePorts:  auto\n')])])]),a("p",[e._v('Verify the restored vault status. You should see "Initialized: true" and\n"Sealed: false":')]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" vault vault-0 -- vault status "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("||")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Key                      Value\n---                      -----\nRecovery Seal Type       shamir\nInitialized              true\nSealed                   false\nTotal Recovery Shares    5\nThreshold                3\nVersion                  1.8.1\nStorage Type             file\nCluster Name             vault-cluster-35710bf5\nCluster ID               4b7168eb-6bfc-30fa-8ab9-060477394dc6\nHA Enabled               false\n")])])]),a("p",[e._v("Delete the backup")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("velero backup delete backup-vault "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--confirm")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('Request to delete backup "backup-vault" submitted successfully.\nThe backup will be fully deleted after all associated data (disk snapshots, backup files, restores) are removed.\n')])])]),a("h2",{attrs:{id:"backup-delete-restore-app-with-efs-storage-using-restic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backup-delete-restore-app-with-efs-storage-using-restic"}},[e._v("#")]),e._v(" Backup + Delete + Restore app with EFS storage using restic")]),e._v(" "),a("p",[e._v("Run pod writing to the EFS storage:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" - "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('EOF\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: backup-test\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: efs-backup-test-pv\n  namespace: backup-test\nspec:\n  accessModes:\n    - ReadWriteMany\n  storageClassName: efs-drupal\n  resources:\n    requests:\n      storage: 1Gi\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: test-app\n  namespace: backup-test\nspec:\n  containers:\n  - name: app\n    image: alpine:3\n    securityContext:\n      runAsUser: 1000\n      runAsGroup: 3000\n      readOnlyRootFilesystem: true\n    command: ["/bin/sh"]\n    args: ["-c", "while true; do date >> /data/out.txt; sleep 5; done"]\n    volumeMounts:\n    - name: persistent-storage\n      mountPath: /data\n    resources:\n      requests:\n        memory: "64Mi"\n        cpu: "250m"\n      limits:\n        memory: "128Mi"\n        cpu: "500m"\n  volumes:\n  - name: persistent-storage\n    persistentVolumeClaim:\n      claimName: efs-backup-test-pv\nEOF')]),e._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("wait")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" backup-test "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--for")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("condition"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("Ready "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("5m pod test-app\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n")])])]),a("p",[e._v("The file is being continuously updated")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-it")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" backup-test test-app -- "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" /data/out.txt\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v('Run backup of "backup-test" namespace:')]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("velero backup create backup-test --default-volumes-to-restic "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--ttl")]),e._v(" 24h --include-namespaces"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("backup-test "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--wait")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v("Check the backups:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("velero get backups\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v('See the details of the "backup-test":')]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("velero backup describe backup-test "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--details")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v("See the files in S3 bucket:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("aws s3 "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ls")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--recursive")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"s3://'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v('/velero/backups/backup-test/"')]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v('Check the "backup-test" namespace and it\'s objects:')]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get pods,pvc,secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" backup-test\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v('Remove "backup-test" namespace - simulate unfortunate deletion of namespace:')]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl delete namespace backup-test\n")])])]),a("p",[e._v('Restore the object in the "backup-test" namespace:')]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("velero restore create restore-backup-test --from-backup backup-test --include-namespaces backup-test "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--wait")]),e._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("wait")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" backup-test "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--for")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("condition"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("Ready "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("5m pod test-app\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v("Get recovery list:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("velero restore get\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v("Get the details about recovery:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("velero restore describe restore-backup-test\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v('Check the "backup-test" namespace and it\'s objects:')]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get pods,pvc,secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" backup-test\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v('Check if the file "/data/out.txt" is being updated and see the "time gap":')]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-it")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" backup-test test-app -- "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" /data/out.txt\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v("Delete the backup")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("velero backup delete backup-test "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--confirm")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code")])]),a("p",[e._v("Delete namespace:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl delete namespace backup-test\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);