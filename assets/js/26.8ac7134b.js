(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{313:function(a,e,t){"use strict";t.r(e);var s=t(8),r=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"dns-ingress-certificates"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dns-ingress-certificates"}},[a._v("#")]),a._v(" DNS, Ingress, Certificates")]),a._v(" "),e("p",[a._v("Install the basic tools, before running some applications like DNS integration\n("),e("a",{attrs:{href:"https://github.com/kubernetes-sigs/external-dns",target:"_blank",rel:"noopener noreferrer"}},[a._v("external-dns"),e("OutboundLink")],1),a._v("), Ingress ("),e("a",{attrs:{href:"https://kubernetes.github.io/ingress-nginx/",target:"_blank",rel:"noopener noreferrer"}},[a._v("ingress-nginx"),e("OutboundLink")],1),a._v("),\ncertificate management ("),e("a",{attrs:{href:"https://cert-manager.io/",target:"_blank",rel:"noopener noreferrer"}},[a._v("cert-manager"),e("OutboundLink")],1),a._v("), ...")]),a._v(" "),e("h2",{attrs:{id:"cert-manager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cert-manager"}},[a._v("#")]),a._v(" cert-manager")]),a._v(" "),e("p",[a._v("Install "),e("code",[a._v("cert-manager")]),a._v(" "),e("a",{attrs:{href:"https://artifacthub.io/packages/helm/jetstack/cert-manager",target:"_blank",rel:"noopener noreferrer"}},[a._v("helm chart"),e("OutboundLink")],1),a._v("\nand modify the\n"),e("a",{attrs:{href:"https://github.com/jetstack/cert-manager/blob/master/deploy/charts/cert-manager/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("default values"),e("OutboundLink")],1),a._v(".\nService account "),e("code",[a._v("external-dns")]),a._v(" was created by "),e("code",[a._v("eksctl")]),a._v(".")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" --force-update jetstack https://charts.jetstack.io\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" v1.5.3 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" cert-manager "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--values")]),a._v(" - cert-manager jetstack/cert-manager "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\ninstallCRDs: true\nserviceAccount:\n  create: false\n  name: cert-manager\nextraArgs:\n  - --enable-certificate-owner-ref=true\nprometheus:\n  servicemonitor:\n    enabled: true\nwebhook:\n  # Needed for Calico\n  securePort: 10251\n  hostNetwork: true\nEOF")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sleep")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n")])])]),e("p",[a._v("Add ClusterIssuers for Let's Encrypt staging and production:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-staging-dns\n  namespace: cert-manager\nspec:\n  acme:\n    server: https://acme-staging-v02.api.letsencrypt.org/directory\n    email: "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${MY_EMAIL}")]),a._v("\n    privateKeySecretRef:\n      name: letsencrypt-staging-dns\n    solvers:\n      - selector:\n          dnsZones:\n            - "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\n        dns01:\n          route53:\n            region: "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${AWS_DEFAULT_REGION}")]),a._v("\n---\n# Create ClusterIssuer for production to get real signed certificates\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-production-dns\n  namespace: cert-manager\nspec:\n  acme:\n    server: https://acme-v02.api.letsencrypt.org/directory\n    email: "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${MY_EMAIL}")]),a._v("\n    privateKeySecretRef:\n      name: letsencrypt-production-dns\n    solvers:\n      - selector:\n          dnsZones:\n            - "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\n        dns01:\n          route53:\n            region: "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${AWS_DEFAULT_REGION}")]),a._v("\nEOF")]),a._v("\n\nkubectl "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("wait")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" cert-manager "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--timeout")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("10m "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--for")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("condition"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Ready clusterissuer "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--all")]),a._v("\n")])])]),e("p",[a._v("Create wildcard certificate using "),e("code",[a._v("cert-manager")]),a._v(":")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: ingress-cert-"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${LETSENCRYPT_ENVIRONMENT}")]),a._v("\n  namespace: cert-manager\nspec:\n  secretName: ingress-cert-"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${LETSENCRYPT_ENVIRONMENT}")]),a._v('\n  secretTemplate:\n    annotations:\n      kubed.appscode.com/sync: ""\n  issuerRef:\n    name: letsencrypt-'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${LETSENCRYPT_ENVIRONMENT}")]),a._v('-dns\n    kind: ClusterIssuer\n  commonName: "*.'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('"\n  dnsNames:\n    - "*.'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('"\n    - "'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('"\nEOF')]),a._v("\n\nkubectl "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("wait")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" cert-manager "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--for")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("condition"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Ready "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--timeout")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("20m certificate "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ingress-cert-'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${LETSENCRYPT_ENVIRONMENT}")]),a._v('"')]),a._v("\n")])])]),e("h2",{attrs:{id:"kubed"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubed"}},[a._v("#")]),a._v(" kubed")]),a._v(" "),e("p",[e("code",[a._v("kubed")]),a._v(" - tool which helps with copying the certificate secretes across the\nnamespaces.")]),a._v(" "),e("p",[a._v("See the details:")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://cert-manager.io/docs/faq/kubed/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://cert-manager.io/docs/faq/kubed/"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://web.archive.org/web/20230605162825/https://appscode.com/products/kubed/v0.12.0/guides/config-syncer/intra-cluster/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://web.archive.org/web/20230605162825/https://appscode.com/products/kubed/v0.12.0/guides/config-syncer/intra-cluster/"),e("OutboundLink")],1)])]),a._v(" "),e("p",[a._v("Install "),e("code",[a._v("kubed")]),a._v(" "),e("a",{attrs:{href:"https://artifacthub.io/packages/helm/appscode/kubed",target:"_blank",rel:"noopener noreferrer"}},[a._v("helm chart"),e("OutboundLink")],1),a._v("\nand modify the\n"),e("a",{attrs:{href:"https://github.com/kubeops/config-syncer/blob/2310687a9ee63ba22ef272cbaaef8f7f89314183/charts/kubed/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("default values"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" --force-update appscode https://charts.appscode.com/stable/\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" v0.12.0 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" kubed --create-namespace "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--values")]),a._v(" - kubed appscode/kubed "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\nimagePullPolicy: Always\nconfig:\n  clusterName: "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\nEOF")]),a._v("\n")])])]),e("h2",{attrs:{id:"ingress-nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ingress-nginx"}},[a._v("#")]),a._v(" ingress-nginx")]),a._v(" "),e("p",[a._v("Install "),e("code",[a._v("ingress-nginx")]),a._v(" "),e("a",{attrs:{href:"https://artifacthub.io/packages/helm/ingress-nginx/ingress-nginx",target:"_blank",rel:"noopener noreferrer"}},[a._v("helm chart"),e("OutboundLink")],1),a._v("\nand modify the\n"),e("a",{attrs:{href:"https://github.com/kubernetes/ingress-nginx/blob/master/charts/ingress-nginx/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("default values"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" --force-update ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.35")]),a._v(".0 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" ingress-nginx --create-namespace "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--wait")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--values")]),a._v(" - ingress-nginx ingress-nginx/ingress-nginx "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('EOF\ncontroller:\n  # Needed for Calico\n  hostNetwork: true\n  replicaCount: 1\n  service:\n    annotations:\n      service.beta.kubernetes.io/aws-load-balancer-backend-protocol: tcp\n      service.beta.kubernetes.io/aws-load-balancer-type: nlb\n      service.beta.kubernetes.io/aws-load-balancer-additional-resource-tags: "'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${TAGS}")]),a._v('"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tr")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('" "')]),a._v(" ,"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"\n  metrics:\n    enabled: true\n    serviceMonitor:\n      enabled: true\n    prometheusRule:\n      enabled: true\n      rules:\n        - alert: NGINXConfigFailed\n          expr: count(nginx_ingress_controller_config_last_reload_successful == 0) > 0\n          for: 1s\n          labels:\n            severity: critical\n          annotations:\n            description: bad ingress config - nginx config test failed\n            summary: uninstall the latest ingress changes to allow config reloads to resume\n        - alert: NGINXCertificateExpiry\n          expr: (avg(nginx_ingress_controller_ssl_expire_time_seconds) by (host) - time()) < 604800\n          for: 1s\n          labels:\n            severity: critical\n          annotations:\n            description: ssl certificate(s) will expire in less then a week\n            summary: renew expiring certificates to avoid downtime\n        - alert: NGINXTooMany500s\n          expr: 100 * ( sum( nginx_ingress_controller_requests{status=~"5.+"} ) / sum(nginx_ingress_controller_requests) ) > 5\n          for: 1m\n          labels:\n            severity: warning\n          annotations:\n            description: Too many 5XXs\n            summary: More than 5% of all requests returned 5XX, this requires your attention\n        - alert: NGINXTooMany400s\n          expr: 100 * ( sum( nginx_ingress_controller_requests{status=~"4.+"} ) / sum(nginx_ingress_controller_requests) ) > 5\n          for: 1m\n          labels:\n            severity: warning\n          annotations:\n            description: Too many 4XXs\n            summary: More than 5% of all requests returned 4XX, this requires your attention\nEOF')]),a._v("\n")])])]),e("h2",{attrs:{id:"istio-and-related-tools"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#istio-and-related-tools"}},[a._v("#")]),a._v(" Istio and related tools")]),a._v(" "),e("h3",{attrs:{id:"jaeger"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jaeger"}},[a._v("#")]),a._v(" Jaeger")]),a._v(" "),e("p",[a._v("Install "),e("code",[a._v("jaeger-operator")]),a._v(" "),e("a",{attrs:{href:"https://github.com/jaegertracing/helm-charts/tree/master/charts/jaeger-operator",target:"_blank",rel:"noopener noreferrer"}},[a._v("helm chart"),e("OutboundLink")],1),a._v("\nand modify the\n"),e("a",{attrs:{href:"https://github.com/jaegertracing/helm-charts/blob/master/charts/jaeger-operator/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("default values"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" --force-update jaegertracing https://jaegertracing.github.io/helm-charts\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.23")]),a._v(".0 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" jaeger-operator --create-namespace "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--values")]),a._v(" - jaeger-operator jaegertracing/jaeger-operator "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\nrbac:\n  clusterRole: true\nEOF")]),a._v("\n")])])]),e("p",[a._v("Allow Jaeger to install Jaeger into "),e("code",[a._v("jaeger-controlplane")]),a._v(":")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl get namespace jaeger-system "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&>")]),a._v(" /dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" kubectl create namespace jaeger-system\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# https://github.com/jaegertracing/jaeger-operator/blob/master/deploy/cluster_role_binding.yaml")]),a._v("\nkubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: jaeger-operator-in-jaeger-system\n  namespace: jaeger-system\nsubjects:\n  - kind: ServiceAccount\n    name: jaeger-operator\n    namespace: jaeger-operator\nroleRef:\n  kind: Role\n  name: jaeger-operator\n  apiGroup: rbac.authorization.k8s.io\nEOF")]),a._v("\n")])])]),e("p",[a._v("Create Jaeger using the operator:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\napiVersion: jaegertracing.io/v1\nkind: Jaeger\nmetadata:\n  namespace: jaeger-system\n  name: jaeger-controlplane\nspec:\n  strategy: AllInOne\n  allInOne:\n    image: jaegertracing/all-in-one:1.21\n    options:\n      log-level: debug\n  storage:\n    type: memory\n    options:\n      memory:\n        max-traces: 100000\n  ingress:\n    enabled: true\n    annotations:\n      nginx.ingress.kubernetes.io/auth-url: https://oauth2-proxy."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("/oauth2/auth\n      nginx.ingress.kubernetes.io/auth-signin: https://oauth2-proxy."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("/oauth2/start?rd=\\"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$scheme")]),a._v("://\\"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$host")]),a._v("\\"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request_uri")]),a._v("\n    hosts:\n      - jaeger."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\n    tls:\n      - secretName: ingress-cert-"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${LETSENCRYPT_ENVIRONMENT}")]),a._v("\n        hosts:\n          - jaeger."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\nEOF")]),a._v("\n")])])]),e("p",[a._v("Allow Jaeger to be monitored by Prometheus "),e("a",{attrs:{href:"https://github.com/jaegertracing/jaeger-operator/issues/538",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/jaegertracing/jaeger-operator/issues/538"),e("OutboundLink")],1),a._v(":")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('EOF\napiVersion: monitoring.coreos.com/v1\nkind: PodMonitor\nmetadata:\n  name: tracing\n  namespace: jaeger-system\nspec:\n  podMetricsEndpoints:\n  - interval: 5s\n    port: "admin-http"\n  selector:\n    matchLabels:\n      app: jaeger\nEOF')]),a._v("\n")])])]),e("h3",{attrs:{id:"istio"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#istio"}},[a._v("#")]),a._v(" Istio")]),a._v(" "),e("p",[a._v("Download "),e("code",[a._v("istioctl")]),a._v(":")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ISTIO_VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.10.2"')]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("command")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" istioctl "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&>")]),a._v(" /dev/null"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Darwin"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ISTIOCTL_URL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://github.com/istio/istio/releases/download/'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ISTIO_VERSION}")]),a._v("/istioctl-"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ISTIO_VERSION}")]),a._v('-osx.tar.gz"')]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ISTIOCTL_URL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://github.com/istio/istio/releases/download/'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ISTIO_VERSION}")]),a._v("/istioctl-"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ISTIO_VERSION}")]),a._v('-linux-amd64.tar.gz"')]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ISTIOCTL_URL}")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xz "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /usr/local/bin/\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n")])])]),e("p",[a._v("Clone the "),e("code",[a._v("istio")]),a._v(" repository and install "),e("code",[a._v("istio-operator")]),a._v(" "),e("a",{attrs:{href:"https://github.com/istio/istio/tree/master/manifests/charts/istio-operator",target:"_blank",rel:"noopener noreferrer"}},[a._v("helm chart"),e("OutboundLink")],1),a._v("\nand modify the\n"),e("a",{attrs:{href:"https://github.com/istio/istio/blob/master/manifests/charts/istio-operator/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("default values"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tmp/'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('/istio"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--quiet")]),a._v(" https://github.com/istio/istio.git "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tmp/'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('/istio"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tmp/'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('/istio"')]),a._v(" checkout "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--quiet")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ISTIO_VERSION}")]),a._v('"')]),a._v("\n\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v(" istio-operator "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tmp/'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('/istio/manifests/charts/istio-operator"')]),a._v("\n")])])]),e("p",[a._v("Create Istio using the operator:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl get namespace istio-system "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&>")]),a._v(" /dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" kubectl create namespace istio-system\nkubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('EOF\napiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nmetadata:\n  namespace: istio-system\n  name: istio-controlplane\nspec:\n  profile: default\n  meshConfig:\n    enableTracing: true\n    enableAutoMtls: true\n    defaultConfig:\n      tracing:\n        zipkin:\n          address: "jaeger-controlplane-collector-headless.jaeger-system.svc.cluster.local:9411"\n        sampling: 100\n      sds:\n        enabled: true\n  components:\n    egressGateways:\n      - name: istio-egressgateway\n        enabled: true\n    ingressGateways:\n      - name: istio-ingressgateway\n        enabled: true\n        k8s:\n          serviceAnnotations:\n            service.beta.kubernetes.io/aws-load-balancer-backend-protocol: tcp\n            service.beta.kubernetes.io/aws-load-balancer-type: nlb\n            service.beta.kubernetes.io/aws-load-balancer-additional-resource-tags: "'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${TAGS"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(",")]),a._v("}")]),a._v('"\n    pilot:\n      k8s:\n        overlays:\n          - kind: Deployment\n            name: istiod\n            patches:\n              - path: spec.template.spec.hostNetwork\n                value: true\n        # Reduce resource requirements for local testing. This is NOT recommended for the real use cases\n        resources:\n          limits:\n            cpu: 200m\n            memory: 128Mi\n          requests:\n            cpu: 100m\n            memory: 64Mi\nEOF')]),a._v("\n")])])]),e("p",[a._v("Enable Prometheus monitoring:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://raw.githubusercontent.com/istio/istio/'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ISTIO_VERSION}")]),a._v('/samples/addons/extras/prometheus-operator.yaml"')]),a._v("\n")])])]),e("h3",{attrs:{id:"kiali"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kiali"}},[a._v("#")]),a._v(" Kiali")]),a._v(" "),e("p",[a._v("Install "),e("code",[a._v("kiali-operator")]),a._v(" "),e("a",{attrs:{href:"https://github.com/kiali/helm-charts/tree/master/kiali-operator",target:"_blank",rel:"noopener noreferrer"}},[a._v("helm chart"),e("OutboundLink")],1),a._v("\nand modify the\n"),e("a",{attrs:{href:"https://github.com/kiali/helm-charts/blob/master/kiali-operator/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("default values"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" --force-update kiali https://kiali.org/helm-charts\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.38")]),a._v(".1 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" kiali-operator --create-namespace kiali-operator kiali/kiali-operator\n")])])]),e("p",[a._v("Install Kiali CR:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# https://github.com/kiali/kiali-operator/blob/master/deploy/kiali/kiali_cr.yaml")]),a._v("\nkubectl get namespace kiali "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&>")]),a._v(" /dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" kubectl create namespace kiali\nkubectl get secret "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" kiali kiali "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" kubectl create secret generic kiali --from-literal"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"oidc-secret='),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${MY_PASSWORD}")]),a._v('"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" kiali\nkubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\napiVersion: kiali.io/v1alpha1\nkind: Kiali\nmetadata:\n  namespace: kiali-operator\n  name: kiali\nspec:\n  istio_namespace: istio-system\n  auth:\n    strategy: openid\n    openid:\n      client_id: kiali."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('\n      disable_rbac: true\n      insecure_skip_verify_tls: true\n      issuer_uri: "https://dex.'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('"\n      username_claim: email\n  deployment:\n    accessible_namespaces: ["**"]\n    namespace: kiali\n    override_ingress_yaml:\n      spec:\n        rules:\n        - host: kiali.'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\n          http:\n            paths:\n            - path: /\n              pathType: ImplementationSpecific\n              backend:\n                service:\n                  name: kiali\n                  port:\n                    number: 20001\n          tls:\n            - secretName: ingress-cert-"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${LETSENCRYPT_ENVIRONMENT}")]),a._v("\n              hosts:\n                - kiali."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('\n  external_services:\n    grafana:\n      is_core_component: true\n      url: "https://grafana.'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('"\n      in_cluster_url: "http://kube-prometheus-stack-grafana.kube-prometheus-stack.svc.cluster.local:80"\n    prometheus:\n      is_core_component: true\n      url: http://kube-prometheus-stack-prometheus.kube-prometheus-stack.svc.cluster.local:9090\n    tracing:\n      is_core_component: true\n      url: https://jaeger.'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\n      in_cluster_url: http://jaeger-controlplane-query.jaeger-system.svc.cluster.local:16686\n  server:\n    web_fqdn: kiali."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\n    web_root: /\nEOF")]),a._v("\n")])])]),e("h2",{attrs:{id:"external-dns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#external-dns"}},[a._v("#")]),a._v(" external-dns")]),a._v(" "),e("p",[a._v("Install "),e("code",[a._v("external-dns")]),a._v(" "),e("a",{attrs:{href:"https://artifacthub.io/packages/helm/bitnami/external-dns",target:"_blank",rel:"noopener noreferrer"}},[a._v("helm chart"),e("OutboundLink")],1),a._v("\nand modify the\n"),e("a",{attrs:{href:"https://github.com/bitnami/charts/blob/master/bitnami/external-dns/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("default values"),e("OutboundLink")],1),a._v(".\n"),e("code",[a._v("external-dns")]),a._v(" will take care about DNS records.\nService account "),e("code",[a._v("external-dns")]),a._v(" was created by "),e("code",[a._v("eksctl")]),a._v(".")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" --force-update bitnami https://charts.bitnami.com/bitnami\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.4")]),a._v(".1 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" external-dns "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--values")]),a._v(" - external-dns bitnami/external-dns "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\nsources:\n  - ingress\n  - istio-gateway\n  - istio-virtualservice\n  - service\naws:\n  region: "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${AWS_DEFAULT_REGION}")]),a._v("\ndomainFilters:\n  - "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\ninterval: 20s\npolicy: sync\nserviceAccount:\n  create: false\n  name: external-dns\nmetrics:\n  enabled: true\n  serviceMonitor:\n    enabled: true\nEOF")]),a._v("\n")])])]),e("h2",{attrs:{id:"mailhog"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mailhog"}},[a._v("#")]),a._v(" mailhog")]),a._v(" "),e("p",[a._v("Install "),e("code",[a._v("mailhog")]),a._v(" "),e("a",{attrs:{href:"https://artifacthub.io/packages/helm/codecentric/mailhog",target:"_blank",rel:"noopener noreferrer"}},[a._v("helm chart"),e("OutboundLink")],1),a._v("\nand modify the\n"),e("a",{attrs:{href:"https://github.com/codecentric/helm-charts/blob/master/charts/mailhog/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("default values"),e("OutboundLink")],1),a._v(".")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("helm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" --force-update codecentric https://codecentric.github.io/helm-charts\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("4.1")]),a._v(".0 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" mailhog --create-namespace "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--values")]),a._v(" - mailhog codecentric/mailhog "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\ningress:\n  enabled: true\n  annotations:\n    nginx.ingress.kubernetes.io/auth-url: https://oauth2-proxy."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("/oauth2/auth\n    nginx.ingress.kubernetes.io/auth-signin: https://oauth2-proxy."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("/oauth2/start?rd=\\"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$scheme")]),a._v("://\\"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$host")]),a._v("\\"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request_uri")]),a._v("\n  hosts:\n    - host: mailhog."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v('\n      paths: ["/"]\n  tls:\n    - secretName: ingress-cert-'),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${LETSENCRYPT_ENVIRONMENT}")]),a._v("\n      hosts:\n        - mailhog."),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${CLUSTER_FQDN}")]),a._v("\nEOF")]),a._v("\n")])])]),e("h2",{attrs:{id:"kubewatch-obsolete"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubewatch-obsolete"}},[a._v("#")]),a._v(" kubewatch - obsolete")]),a._v(" "),e("p",[a._v("Install "),e("code",[a._v("kubewatch")]),a._v(":")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# helm upgrade --install --version 3.2.13 --namespace kubewatch --create-namespace --values - kubewatch bitnami/kubewatch << EOF")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# slack:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   enabled: true")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#   channel: "#${SLACK_CHANNEL}"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   token: ${SLACK_BOT_API_TOKEN}")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# smtp:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   enabled: true")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#   to: "notification@${CLUSTER_FQDN}"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#   from: "kubewatch@${CLUSTER_FQDN}"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#   smarthost: "mailhog.mailhog.svc.cluster.local:1025"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#   subject: "kubewatch"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   requireTLS: false")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# resourcesToWatch:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   deployment: false")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   pod: false")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   persistentvolume: true")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   namespace: true")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# rbac:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   create: false")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# EOF")]),a._v("\n")])])]),e("p",[a._v("Create "),e("code",[a._v("ClusterRole")]),a._v(" and "),e("code",[a._v("ClusterRoleBinding")]),a._v(" to allow "),e("code",[a._v("kubewatch")]),a._v(" to access\nnecessary resources:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kubectl apply -f - << EOF")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# apiVersion: rbac.authorization.k8s.io/v1beta1")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kind: ClusterRole")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# metadata:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   name: system:kubewatch")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# rules:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# - apiGroups:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#   - ""')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   resources:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   - namespaces")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   - persistentvolumes")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   verbs:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   - list")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   - watch")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   - get")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ---")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# apiVersion: rbac.authorization.k8s.io/v1beta1")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kind: ClusterRoleBinding")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# metadata:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   name: system:kubewatch")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# roleRef:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   apiGroup: rbac.authorization.k8s.io")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   kind: ClusterRole")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   name: system:kubewatch")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# subjects:")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# - kind: ServiceAccount")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   name: kubewatch")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   namespace: kubewatch")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# EOF")]),a._v("\n")])])]),e("h2",{attrs:{id:"calico-commands"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#calico-commands"}},[a._v("#")]),a._v(" Calico commands")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("calicoctl --allow-version-mismatch ipam show --show-block\n")])])]),e("p",[a._v("Output:")]),a._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("+----------+-------------------+-----------+------------+--------------+\n| GROUPING |       CIDR        | IPS TOTAL | IPS IN USE |   IPS FREE   |\n+----------+-------------------+-----------+------------+--------------+\n| IP Pool  | 172.16.0.0/16     |     65536 | 42 (0%)    | 65494 (100%) |\n| Block    | 172.16.166.128/26 |        64 | 14 (22%)   | 50 (78%)     |\n| Block    | 172.16.2.128/26   |        64 | 13 (20%)   | 51 (80%)     |\n| Block    | 172.16.3.64/26    |        64 | 15 (23%)   | 49 (77%)     |\n+----------+-------------------+-----------+------------+--------------+\n")])])]),e("p",[a._v("Block outgoing traffic form "),e("code",[a._v("calico-test-1")]),a._v(" namespace:")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl get namespace calico-test-1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&>")]),a._v(" /dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" kubectl create namespace calico-test-1\n\ncalicoctl --allow-version-mismatch apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('EOF\napiVersion: projectcalico.org/v3\nkind: GlobalNetworkPolicy\nmetadata:\n  name: calico-test-disable-all-egress\nspec:\n  namespaceSelector: has(projectcalico.org/name) && projectcalico.org/name starts with "calico-test"\n  types:\n  - Ingress\n  - Egress\n  ingress:\n  - action: Allow\n  egress:\n  # Except DNS\n  - action: Allow\n    protocol: TCP\n    destination:\n      ports:\n      - 53\n  - action: Allow\n    protocol: UDP\n    destination:\n      ports:\n      - 53\nEOF')]),a._v("\n\nkubectl run curl-test-1 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--timeout")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("10m "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" calico-test-1 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("radial/busyboxplus:curl "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ping")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),a._v(" www.google.com\n")])])]),e("p",[a._v("Output:")]),a._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("--- www.google.com ping statistics ---\n50 packets transmitted, 0 packets received, 100% packet loss\n")])])]),e("p",[a._v("Try the same in "),e("code",[a._v("calico-test-2")]),a._v(", but allow traffic to "),e("code",[a._v("1.1.1.1")]),a._v(":")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl get namespace calico-test-2 "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&>")]),a._v(" /dev/null "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" kubectl create namespace calico-test-2\n\nkubectl apply "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" - "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-egress-1.1.1.1\n  namespace: calico-test-2\nspec:\n  podSelector: {}\n  egress:\n  - to:\n    - ipBlock:\n        cidr: 1.1.1.1/32\nEOF")]),a._v("\n\nkubectl run curl-test-1 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" calico-test-2 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("radial/busyboxplus:curl "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ping")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),a._v(" www.google.com\nkubectl run curl-test-2 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" calico-test-2 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("radial/busyboxplus:curl "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ping")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.1")]),a._v(".1.1\n")])])]),e("p",[a._v("Output:")]),a._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("--- www.google.com ping statistics ---\n50 packets transmitted, 0 packets received, 100% packet loss\n\n--- 1.1.1.1 ping statistics ---\n3 packets transmitted, 3 packets received, 0% packet loss\nround-trip min/avg/max = 1.309/1.348/1.399 ms\n")])])]),e("p",[a._v("Ping should be working fine in namespaces which doesn't start with "),e("code",[a._v("calico-test")]),a._v("\n(like "),e("code",[a._v("default")]),a._v("):")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("kubectl run curl-test "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--namespace")]),a._v(" default "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("radial/busyboxplus:curl "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ping")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),a._v(" www.google.com\n")])])]),e("p",[a._v("Output:")]),a._v(" "),e("div",{staticClass:"language-text extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("--- www.google.com ping statistics ---\n3 packets transmitted, 3 packets received, 0% packet loss\nround-trip min/avg/max = 1.398/1.417/1.430 ms\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);