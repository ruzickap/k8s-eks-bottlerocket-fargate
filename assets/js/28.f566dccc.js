(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{317:function(e,a,t){"use strict";t.r(a);var n=t(8),s=Object(n.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"others"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#others"}},[e._v("#")]),e._v(" Others")]),e._v(" "),a("h2",{attrs:{id:"cluster-autoscaler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cluster-autoscaler"}},[e._v("#")]),e._v(" cluster-autoscaler")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("cluster-autoscaler")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/cluster-autoscaler/cluster-autoscaler",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/kubernetes/autoscaler/blob/master/charts/cluster-autoscaler/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update autoscaler https://kubernetes.github.io/autoscaler\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("9.10")]),e._v(".4 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--wait")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - cluster-autoscaler autoscaler/cluster-autoscaler "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nautoDiscovery:\n  clusterName: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_NAME}")]),e._v("\nawsRegion: "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${AWS_DEFAULT_REGION}")]),e._v("\n# Required to fix IMDSv2 issue: https://github.com/kubernetes/autoscaler/issues/3592\nextraArgs:\n  aws-use-static-instance-list: true\nrbac:\n  serviceAccount:\n    create: false\n    name: cluster-autoscaler\nserviceMonitor:\n  enabled: true\n  namespace: kube-prometheus-stack\nprometheusRule:\n  enabled: false\n  namespace: kube-prometheus-stack\nEOF")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n")])])]),a("p",[e._v("You can test it by running "),a("code",[e._v("pause")]),e._v(" container consuming "),a("code",[e._v("cpu: 3")]),e._v(" resources :")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" - "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: pasue-deployment\n  labels:\n    app: pause\n  annotations:\n    ignore-check.kube-linter.io/no-read-only-root-fs : "Not needed"\nspec:\n  replicas: 15\n  selector:\n    matchLabels:\n      app: pause\n  template:\n    metadata:\n      labels:\n        app: pause\n    spec:\n      affinity:\n        podAntiAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n          - topologyKey: "kubernetes.io/hostname"\n            labelSelector:\n              matchLabels:\n                app: pause\n      containers:\n      - name: pause\n        image: k8s.gcr.io/pause:3.6\n        resources:\n          requests:\n            cpu: 100m\n            memory: "1024Mi"\n          limits:\n            cpu: 100m\n            memory: "1024Mi"\n      securityContext:\n        runAsUser: 10001\nEOF')]),e._v("\n")])])]),a("p",[e._v("There should be 3 nodes started by default:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get nodes "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-L")]),e._v(" node.kubernetes.io/instance-type "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-L")]),e._v(" topology.kubernetes.io/zone\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("70")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                                           STATUS   ROLES    AGE   VERSION   INSTANCE-TYPE   ZONE\nip-192-168-31-11.eu-west-1.compute.internal    Ready    &lt;none>   21m   v1.21.6   t3.xlarge       eu-west-1a\nip-192-168-56-82.eu-west-1.compute.internal    Ready    &lt;none>   21m   v1.21.6   t3.xlarge       eu-west-1b\nip-192-168-60-184.eu-west-1.compute.internal   Ready    &lt;none>   21m   v1.21.6   t3.xlarge       eu-west-1b\n")])])]),a("p",[e._v("Check the details - some pods are still in pending state\n(they are waiting for new node):")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),e._v(" wide\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                                READY   STATUS              RESTARTS   AGE   IP               NODE                                           NOMINATED NODE   READINESS GATES\npasue-deployment-648c54d8c6-498tx   0/1     Pending             0          70s   &lt;none>           &lt;none>                                         &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-4wr5f   1/1     Running             0          71s   172.16.166.146   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-579dx   1/1     Running             0          70s   172.16.2.147     ip-192-168-31-11.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-5vqrr   1/1     Running             0          70s   172.16.3.89      ip-192-168-60-184.eu-west-1.compute.internal   &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-5zr8k   1/1     Running             0          70s   172.16.166.147   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-7kd65   0/1     ContainerCreating   0          70s   &lt;none>           ip-192-168-3-25.eu-west-1.compute.internal     &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-kknlr   1/1     Running             0          70s   172.16.3.88      ip-192-168-60-184.eu-west-1.compute.internal   &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-pcsb8   0/1     ContainerCreating   0          70s   &lt;none>           ip-192-168-3-25.eu-west-1.compute.internal     &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-qcdpw   1/1     Running             0          70s   172.16.2.146     ip-192-168-31-11.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-s8qcm   0/1     ContainerCreating   0          70s   &lt;none>           ip-192-168-3-25.eu-west-1.compute.internal     &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-sl7mb   0/1     Pending             0          70s   &lt;none>           &lt;none>                                         &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-v7b5x   1/1     Running             0          71s   172.16.3.87      ip-192-168-60-184.eu-west-1.compute.internal   &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-vmshk   1/1     Running             0          71s   172.16.2.145     ip-192-168-31-11.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-zfqfx   1/1     Running             0          70s   172.16.166.148   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-zpmg5   0/1     ContainerCreating   0          70s   &lt;none>           ip-192-168-3-25.eu-west-1.compute.internal     &lt;none>           &lt;none>\n")])])]),a("p",[e._v("The autoscaler ConfigMap should showing 1 more node which is starting up:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get configmap cluster-autoscaler-status "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),e._v(" yaml "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" kube-system\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('apiVersion: v1\ndata:\n  status: |+\n    Cluster-autoscaler status at 2021-11-29 17:44:03.335055488 +0000 UTC:\n    Cluster-wide:\n      Health:      Healthy (ready=4 unready=0 notStarted=1 longNotStarted=0 registered=5 longUnregistered=0)\n                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909\n                   LastTransitionTime: 2021-11-29 17:42:52.673668227 +0000 UTC m=+11.566024230\n      ScaleUp:     InProgress (ready=4 registered=5)\n                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909\n                   LastTransitionTime: 2021-11-29 17:43:02.702663909 +0000 UTC m=+21.595019844\n      ScaleDown:   NoCandidates (candidates=0)\n                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909\n                   LastTransitionTime: 2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909\n\n    NodeGroups:\n      Name:        eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090\n      Health:      Healthy (ready=4 unready=0 notStarted=1 longNotStarted=0 registered=5 longUnregistered=0 cloudProviderTarget=5 (minSize=2, maxSize=5))\n                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909\n                   LastTransitionTime: 2021-11-29 17:42:52.673668227 +0000 UTC m=+11.566024230\n      ScaleUp:     InProgress (ready=4 cloudProviderTarget=5)\n                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909\n                   LastTransitionTime: 2021-11-29 17:43:02.702663909 +0000 UTC m=+21.595019844\n      ScaleDown:   NoCandidates (candidates=0)\n                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909\n                   LastTransitionTime: 2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909\n\nkind: ConfigMap\nmetadata:\n  annotations:\n    cluster-autoscaler.kubernetes.io/last-updated: 2021-11-29 17:44:03.335055488 +0000\n      UTC\n  creationTimestamp: "2021-11-29T17:42:41Z"\n  name: cluster-autoscaler-status\n  namespace: kube-system\n  resourceVersion: "16437"\n  uid: 5b5084d7-9af3-4665-b829-ab210c9a633d\n')])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# shellcheck disable=SC1083")]),e._v("\nkubectl logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--since")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("1m "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-l")]),e._v(" app.kubernetes.io/name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("aws-cluster-autoscaler "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("jsonpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{.items[0].metadata.name}"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v('"')]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("100")]),e._v("\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("...\nI1129 17:43:53.270450       1 static_autoscaler.go:228] Starting main loop\nI1129 17:43:53.292923       1 filter_out_schedulable.go:65] Filtering out schedulables\nI1129 17:43:53.292975       1 filter_out_schedulable.go:132] Filtered out 0 pods using hints\nI1129 17:43:53.293049       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-pcsb8 marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-0. Ignoring in scale up.\nI1129 17:43:53.293094       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-7kd65 marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-0. Ignoring in scale up.\nI1129 17:43:53.293120       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-498tx marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-0. Ignoring in scale up.\nI1129 17:43:53.293147       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-sl7mb marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-0. Ignoring in scale up.\nI1129 17:43:53.293176       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-zpmg5 marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-1. Ignoring in scale up.\nI1129 17:43:53.293201       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-s8qcm marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-1. Ignoring in scale up.\nI1129 17:43:53.293209       1 filter_out_schedulable.go:170] 0 pods were kept as unschedulable based on caching\nI1129 17:43:53.293216       1 filter_out_schedulable.go:171] 6 pods marked as unschedulable can be scheduled.\nI1129 17:43:53.293234       1 filter_out_schedulable.go:79] Schedulable pods present\nI1129 17:43:53.293257       1 static_autoscaler.go:401] No unschedulable pods\nI1129 17:43:53.293279       1 static_autoscaler.go:448] Calculating unneeded nodes\nI1129 17:43:53.293356       1 scale_down.go:447] Node ip-192-168-3-25.eu-west-1.compute.internal - cpu utilization 0.102041\nI1129 17:43:53.293385       1 scale_down.go:447] Node ip-192-168-31-113.eu-west-1.compute.internal - cpu utilization 0.102041\nI1129 17:43:53.293401       1 scale_down.go:508] Scale-down calculation: ignoring 3 nodes unremovable in the last 5m0s\nI1129 17:43:53.293516       1 static_autoscaler.go:491] ip-192-168-3-25.eu-west-1.compute.internal is unneeded since 2021-11-29 17:43:42.944989763 +0000 UTC m=+61.837345699 duration 10.32542882s\nI1129 17:43:53.293537       1 static_autoscaler.go:491] ip-192-168-31-113.eu-west-1.compute.internal is unneeded since 2021-11-29 17:43:42.944989763 +0000 UTC m=+61.837345699 duration 10.32542882s\nI1129 17:43:53.293554       1 static_autoscaler.go:502] Scale down status: unneededOnly=true lastScaleUpTime=2021-11-29 17:43:02.702663909 +0000 UTC m=+21.595019844 lastScaleDownDeleteTime=2021-11-29 17:42:42.673088267 +0000 UTC m=+1.565444188 lastScaleDownFailTime=2021-11-29 17:42:42.673088334 +0000 UTC m=+1.565444256 scaleDownForbidden=true isDeleteInProgress=false scaleDownInCooldown=true\nI1129 17:44:03.332155       1 static_autoscaler.go:228] Starting main loop\nI1129 17:44:03.333608       1 filter_out_schedulable.go:65] Filtering out schedulables\nI1129 17:44:03.333641       1 filter_out_schedulable.go:132] Filtered out 0 pods using hints\nI1129 17:44:03.334074       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-498tx marked as unschedulable can be scheduled on node ip-192-168-31-113.eu-west-1.compute.internal. Ignoring in scale up.\nI1129 17:44:03.334135       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-sl7mb marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-8549944162621642512-0. Ignoring in scale up.\nI1129 17:44:03.334209       1 filter_out_schedulable.go:170] 0 pods were kept as unschedulable based on caching\nI1129 17:44:03.334226       1 filter_out_schedulable.go:171] 2 pods marked as unschedulable can be scheduled.\nI1129 17:44:03.334269       1 filter_out_schedulable.go:79] Schedulable pods present\nI1129 17:44:03.334300       1 static_autoscaler.go:401] No unschedulable pods\nI1129 17:44:03.334319       1 static_autoscaler.go:448] Calculating unneeded nodes\nI1129 17:44:03.334411       1 scale_down.go:443] Node ip-192-168-3-25.eu-west-1.compute.internal is not suitable for removal - memory utilization too big (0.989735)\nI1129 17:44:03.334457       1 scale_down.go:447] Node ip-192-168-31-113.eu-west-1.compute.internal - memory utilization 0.300287\nI1129 17:44:03.334505       1 scale_down.go:508] Scale-down calculation: ignoring 3 nodes unremovable in the last 5m0s\nI1129 17:44:03.334578       1 cluster.go:148] Fast evaluation: ip-192-168-31-113.eu-west-1.compute.internal for removal\nI1129 17:44:03.334761       1 cluster.go:192] Fast evaluation: node ip-192-168-31-113.eu-west-1.compute.internal is not suitable for removal: failed to find place for default/pasue-deployment-648c54d8c6-498tx\nI1129 17:44:03.334810       1 scale_down.go:612] 1 nodes found to be unremovable in simulation, will re-check them at 2021-11-29 17:49:03.332119893 +0000 UTC m=+382.224475909\nI1129 17:44:03.334891       1 static_autoscaler.go:502] Scale down status: unneededOnly=true lastScaleUpTime=2021-11-29 17:43:02.702663909 +0000 UTC m=+21.595019844 lastScaleDownDeleteTime=2021-11-29 17:42:42.673088267 +0000 UTC m=+1.565444188 lastScaleDownFailTime=2021-11-29 17:42:42.673088334 +0000 UTC m=+1.565444256 scaleDownForbidden=true isDeleteInProgress=false scaleDownInCooldown=true\n")])])]),a("p",[e._v("The "),a("code",[e._v("cluster-autoscaler")]),e._v(" should start one more node after some time:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get nodes "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-L")]),e._v(" node.kubernetes.io/instance-type "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-L")]),e._v(" topology.kubernetes.io/zone\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                                           STATUS   ROLES    AGE     VERSION   INSTANCE-TYPE   ZONE\nip-192-168-3-25.eu-west-1.compute.internal     Ready    &lt;none>   2m10s   v1.21.6   t3.xlarge       eu-west-1a\nip-192-168-31-11.eu-west-1.compute.internal    Ready    &lt;none>   23m     v1.21.6   t3.xlarge       eu-west-1a\nip-192-168-31-113.eu-west-1.compute.internal   Ready    &lt;none>   2m4s    v1.21.6   t3.xlarge       eu-west-1a\nip-192-168-56-82.eu-west-1.compute.internal    Ready    &lt;none>   23m     v1.21.6   t3.xlarge       eu-west-1b\nip-192-168-60-184.eu-west-1.compute.internal   Ready    &lt;none>   23m     v1.21.6   t3.xlarge       eu-west-1b\n")])])]),a("p",[e._v("All pods should be running now and some of them are are on the new node:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),e._v(" wide\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                                READY   STATUS    RESTARTS   AGE     IP               NODE                                           NOMINATED NODE   READINESS GATES\npasue-deployment-648c54d8c6-498tx   1/1     Running   0          2m53s   172.16.72.1      ip-192-168-31-113.eu-west-1.compute.internal   &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-4wr5f   1/1     Running   0          2m54s   172.16.166.146   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-579dx   1/1     Running   0          2m53s   172.16.2.147     ip-192-168-31-11.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-5vqrr   1/1     Running   0          2m53s   172.16.3.89      ip-192-168-60-184.eu-west-1.compute.internal   &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-5zr8k   1/1     Running   0          2m53s   172.16.166.147   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-7kd65   1/1     Running   0          2m53s   172.16.190.8     ip-192-168-3-25.eu-west-1.compute.internal     &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-kknlr   1/1     Running   0          2m53s   172.16.3.88      ip-192-168-60-184.eu-west-1.compute.internal   &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-pcsb8   1/1     Running   0          2m53s   172.16.190.4     ip-192-168-3-25.eu-west-1.compute.internal     &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-qcdpw   1/1     Running   0          2m53s   172.16.2.146     ip-192-168-31-11.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-s8qcm   1/1     Running   0          2m53s   172.16.190.1     ip-192-168-3-25.eu-west-1.compute.internal     &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-sl7mb   1/1     Running   0          2m53s   172.16.72.2      ip-192-168-31-113.eu-west-1.compute.internal   &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-v7b5x   1/1     Running   0          2m54s   172.16.3.87      ip-192-168-60-184.eu-west-1.compute.internal   &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-vmshk   1/1     Running   0          2m54s   172.16.2.145     ip-192-168-31-11.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-zfqfx   1/1     Running   0          2m53s   172.16.166.148   ip-192-168-56-82.eu-west-1.compute.internal    &lt;none>           &lt;none>\npasue-deployment-648c54d8c6-zpmg5   1/1     Running   0          2m53s   172.16.190.5     ip-192-168-3-25.eu-west-1.compute.internal     &lt;none>           &lt;none>\n")])])]),a("p",[e._v("If you delete the deployment "),a("code",[e._v("autoscaler-demo")]),e._v(" the "),a("code",[e._v("cluster-autoscaler")]),e._v(" will\ndecrease the number of nodes:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl delete deployment pasue-deployment\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sleep")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("800")]),e._v("\nkubectl get nodes "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-L")]),e._v(" node.kubernetes.io/instance-type "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-L")]),e._v(" topology.kubernetes.io/zone\n")])])]),a("p",[e._v("Output:")]),e._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                                           STATUS                     ROLES    AGE   VERSION   INSTANCE-TYPE   ZONE\nip-192-168-31-11.eu-west-1.compute.internal    Ready                      &lt;none>   37m   v1.21.6   t3.xlarge       eu-west-1a\nip-192-168-31-113.eu-west-1.compute.internal   Ready,SchedulingDisabled   &lt;none>   15m   v1.21.6   t3.xlarge       eu-west-1a\nip-192-168-56-82.eu-west-1.compute.internal    Ready                      &lt;none>   37m   v1.21.6   t3.xlarge       eu-west-1b\nip-192-168-60-184.eu-west-1.compute.internal   Ready                      &lt;none>   37m   v1.21.6   t3.xlarge       eu-west-1b\n")])])]),a("h2",{attrs:{id:"descheduler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#descheduler"}},[e._v("#")]),e._v(" Descheduler")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("descheduler")]),e._v(" "),a("a",{attrs:{href:"https://artifacthub.io/packages/helm/descheduler/descheduler",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/kubernetes-sigs/descheduler/blob/master/charts/descheduler/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update descheduler https://kubernetes-sigs.github.io/descheduler/\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0.21")]),e._v(".0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - descheduler descheduler/descheduler "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('EOF\ncronJobApiVersion: "batch/v1beta1"\nsuccessfulJobsHistoryLimit: 10\nEOF')]),e._v("\n")])])]),a("h2",{attrs:{id:"rancher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rancher"}},[e._v("#")]),e._v(" Rancher")]),e._v(" "),a("p",[e._v("Install "),a("code",[e._v("rancher-server")]),e._v(" "),a("a",{attrs:{href:"https://github.com/rancher/rancher/tree/master/chart",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\nand modify the\n"),a("a",{attrs:{href:"https://github.com/rancher/rancher/blob/master/chart/values.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("default values"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" --force-update rancher-latest https://releases.rancher.com/server-charts/latest\nhelm upgrade "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--version")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2.5")]),e._v(".9 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--namespace")]),e._v(" cattle-system --create-namespace "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--values")]),e._v(" - rancher rancher-latest/rancher "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOF\nhostname: rancher."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("\ningress:\n  extraAnnotations:\n    nginx.ingress.kubernetes.io/auth-url: https://oauth2-proxy."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/auth\n    nginx.ingress.kubernetes.io/auth-signin: https://oauth2-proxy."),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${CLUSTER_FQDN}")]),e._v("/oauth2/start?rd=\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$scheme")]),e._v("://\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$host")]),e._v("\\"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$request_uri")]),e._v("\n  tls:\n    source: secret\n    # Not working right now\n    secretName: ingress-cert-"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v("\nreplicas: 1\nEOF")]),e._v("\n")])])]),a("p",[e._v("Copy the certificate to the secret with name: "),a("code",[e._v("tls-rancher-ingress")]),e._v(".\nRancher "),a("a",{attrs:{href:"https://github.com/rancher/rancher/blob/3c54189441fdac08fd4a1b3113216e085004f061/chart/templates/ingress.yaml#L55",target:"_blank",rel:"noopener noreferrer"}},[e._v("helm chart"),a("OutboundLink")],1),e._v("\ncan not use existing secret for TLS ingress 😦\nIt should be fixed in next helm chart release...")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" cattle-system tls-rancher-ingress "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("||")]),e._v(" kubectl get secret "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-n")]),e._v(" cattle-system "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"ingress-cert-'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${LETSENCRYPT_ENVIRONMENT}")]),e._v('"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-o")]),e._v(" json "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" jq "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('".metadata.name='),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v("tls-rancher-ingress"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[e._v('\\"')]),e._v('"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-f")]),e._v(" -\n")])])])])}),[],!1,null,null,null);a.default=s.exports}}]);