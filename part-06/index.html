<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Others | Amazon EKS Bottlerocket and Fargate</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="https://raw.githubusercontent.com/kubernetes/kubernetes/d9a58a39b69a0eaec5797e0f7a0f9472b4829ab0/logo/logo.svg">
    <meta name="description" content="Amazon EKS Bottlerocket and Fargate">
    
    <link rel="preload" href="/k8s-eks-bottlerocket-fargate/assets/css/0.styles.61693ea3.css" as="style"><link rel="preload" href="/k8s-eks-bottlerocket-fargate/assets/js/app.cd5c61da.js" as="script"><link rel="preload" href="/k8s-eks-bottlerocket-fargate/assets/js/2.a27de003.js" as="script"><link rel="preload" href="/k8s-eks-bottlerocket-fargate/assets/js/1.30a6593f.js" as="script"><link rel="preload" href="/k8s-eks-bottlerocket-fargate/assets/js/28.f566dccc.js" as="script"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/10.340b7a91.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/11.6724c971.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/12.0f6b2c7f.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/13.0f6f4ef5.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/14.28b41666.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/15.d3972987.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/16.4c24402c.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/17.6cd3a12a.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/18.8d7e6487.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/19.78b16bd4.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/20.a3f134b4.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/21.3fb0cd72.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/22.f5ea0076.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/23.a21f8ae6.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/24.c557dbf6.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/25.3d2180e6.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/26.8ac7134b.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/27.050bbf87.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/29.3e3635d0.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/3.6b4152e0.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/30.7ac4c6d1.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/31.ee8b8daa.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/32.85f54686.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/33.b5ef35a1.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/34.6e2c7bbd.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/35.301a3049.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/4.bea5e217.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/5.ac8fedb2.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/6.76ff54c2.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/7.98538131.js"><link rel="prefetch" href="/k8s-eks-bottlerocket-fargate/assets/js/vendors~docsearch.d098b00c.js">
    <link rel="stylesheet" href="/k8s-eks-bottlerocket-fargate/assets/css/0.styles.61693ea3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/k8s-eks-bottlerocket-fargate/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/kubernetes/kubernetes/d9a58a39b69a0eaec5797e0f7a0f9472b4829ab0/logo/logo.svg" alt="Amazon EKS Bottlerocket and Fargate" class="logo"> <span class="site-name can-hide">Amazon EKS Bottlerocket and Fargate</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/k8s-eks-bottlerocket-fargate/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Amazon EKS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://aws.amazon.com/bottlerocket/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bottlerocket
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/ruzickap/k8s-eks-bottlerocket-fargate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/k8s-eks-bottlerocket-fargate/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://aws.amazon.com/eks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Amazon EKS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://aws.amazon.com/bottlerocket/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bottlerocket
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/ruzickap/k8s-eks-bottlerocket-fargate" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/k8s-eks-bottlerocket-fargate/" aria-current="page" class="sidebar-link">Amazon EKS Bottlerocket and Fargate</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/#requirements" class="sidebar-link">Requirements</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/#content" class="sidebar-link">Content</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-01/" class="sidebar-link">Amazon EKS Bottlerocket and Fargate</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-01/#requirements" class="sidebar-link">Requirements</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-01/#prepare-the-local-working-environment" class="sidebar-link">Prepare the local working environment</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-01/#configure-aws-route-53-domain-delegation" class="sidebar-link">Configure AWS Route 53 Domain delegation</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-01/#add-new-domain-to-route-53-policies-s3-ebs" class="sidebar-link">Add new domain to Route 53, Policies, S3, EBS</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-01/#create-amazon-eks" class="sidebar-link">Create Amazon EKS</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-02/" class="sidebar-link">AWS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#fargate" class="sidebar-link">Fargate</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#aws-load-balancer-controller" class="sidebar-link">aws-load-balancer-controller</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#aws-for-fluent-bit" class="sidebar-link">aws-for-fluent-bit</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#aws-cloudwatch-metrics" class="sidebar-link">aws-cloudwatch-metrics</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#aws-efs-csi-driver" class="sidebar-link">aws-efs-csi-driver</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#install-external-snapshotter" class="sidebar-link">Install external-snapshotter</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#aws-ebs-csi-driver" class="sidebar-link">aws-ebs-csi-driver</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#test-amazon-eks-pod-limits" class="sidebar-link">Test Amazon EKS pod limits</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#amazon-managed-prometheus-amazon-managed-grafana" class="sidebar-link">Amazon Managed Prometheus + Amazon Managed Grafana</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#test-eks-access" class="sidebar-link">Test EKS access</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-02/#capsule" class="sidebar-link">Capsule</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-03/" class="sidebar-link">Monitoring and Logging</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#metrics-server" class="sidebar-link">metrics-server</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#prometheus-adapter" class="sidebar-link">prometheus-adapter</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#kube-prometheus-stack" class="sidebar-link">kube-prometheus-stack</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#enable-calico-monitoring" class="sidebar-link">Enable calico monitoring</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#loki" class="sidebar-link">loki</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#aws-node-termination-handler" class="sidebar-link">aws-node-termination-handler</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#kyverno" class="sidebar-link">kyverno</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#nri-bundle" class="sidebar-link">nri-bundle</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#splunk-connect" class="sidebar-link">splunk-connect</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#aqua-security-enforcer" class="sidebar-link">Aqua Security Enforcer</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-03/#sysdig-agent" class="sidebar-link">sysdig-agent</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-04/" class="sidebar-link">DNS, Ingress, Certificates</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-04/#cert-manager" class="sidebar-link">cert-manager</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-04/#kubed" class="sidebar-link">kubed</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-04/#ingress-nginx" class="sidebar-link">ingress-nginx</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-04/#istio-and-related-tools" class="sidebar-link">Istio and related tools</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-04/#external-dns" class="sidebar-link">external-dns</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-04/#mailhog" class="sidebar-link">mailhog</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-04/#kubewatch-obsolete" class="sidebar-link">kubewatch - obsolete</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-04/#calico-commands" class="sidebar-link">Calico commands</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-05/" class="sidebar-link">Authentication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-05/#keycloak" class="sidebar-link">Keycloak</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-05/#oauth2-proxy-keycloak" class="sidebar-link">oauth2-proxy - Keycloak</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-05/#dex" class="sidebar-link">Dex</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-05/#oauth2-proxy" class="sidebar-link">oauth2-proxy</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-05/#gangway" class="sidebar-link">Gangway</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-05/#kube-oidc-proxy" class="sidebar-link">kube-oidc-proxy</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-06/" aria-current="page" class="active sidebar-link">Others</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-06/#cluster-autoscaler" class="sidebar-link">cluster-autoscaler</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-06/#descheduler" class="sidebar-link">Descheduler</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-06/#rancher" class="sidebar-link">Rancher</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-07/" class="sidebar-link">Workloads</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-07/#podinfo" class="sidebar-link">podinfo</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-07/#polaris" class="sidebar-link">Polaris</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-07/#kubei" class="sidebar-link">kubei</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-07/#kube-bench" class="sidebar-link">kube-bench</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-07/#kubernetes-dashboard" class="sidebar-link">kubernetes-dashboard</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-07/#kubeview" class="sidebar-link">kubeview</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-07/#kube-ops-view" class="sidebar-link">kube-ops-view</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-07/#s3-upload-test" class="sidebar-link">S3 upload test</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-08/" class="sidebar-link">Other workloads</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-08/#cluster-api" class="sidebar-link">Cluster API</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-08/#hashicorp-vault" class="sidebar-link">HashiCorp Vault</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-08/#podinfo-with-vault-certificate" class="sidebar-link">podinfo with vault certificate</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-08/#secrets-store-csi-driver" class="sidebar-link">secrets-store-csi-driver</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-08/#kuard" class="sidebar-link">kuard</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-09/" class="sidebar-link">Drupal</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-09/#drupal-installation" class="sidebar-link">Drupal installation</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-10/" class="sidebar-link">Harbor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-10/#cloudwatch-retention" class="sidebar-link">CloudWatch retention</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-11/" class="sidebar-link">Velero</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-11/#backup-vault-using-csi-volume-snapshotting" class="sidebar-link">Backup Vault using CSI Volume Snapshotting</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-11/#delete-restore-vault-using-csi-volume-snapshotting" class="sidebar-link">Delete + Restore Vault using CSI Volume Snapshotting</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-11/#backup-delete-restore-app-with-efs-storage-using-restic" class="sidebar-link">Backup + Delete + Restore app with EFS storage using restic</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-12/" class="sidebar-link">GitOps tools</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-12/#argocd" class="sidebar-link">ArgoCD</a></li><li class="sidebar-sub-header"><a href="/k8s-eks-bottlerocket-fargate/part-12/#flux" class="sidebar-link">Flux</a></li></ul></li><li><a href="/k8s-eks-bottlerocket-fargate/part-13/" class="sidebar-link">Clean-up</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="others"><a href="#others" class="header-anchor">#</a> Others</h1> <h2 id="cluster-autoscaler"><a href="#cluster-autoscaler" class="header-anchor">#</a> cluster-autoscaler</h2> <p>Install <code>cluster-autoscaler</code> <a href="https://artifacthub.io/packages/helm/cluster-autoscaler/cluster-autoscaler" target="_blank" rel="noopener noreferrer">helm chart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
and modify the
<a href="https://github.com/kubernetes/autoscaler/blob/master/charts/cluster-autoscaler/values.yaml" target="_blank" rel="noopener noreferrer">default values<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>helm repo <span class="token function">add</span> --force-update autoscaler https://kubernetes.github.io/autoscaler
helm upgrade <span class="token parameter variable">--install</span> <span class="token parameter variable">--version</span> <span class="token number">9.10</span>.4 <span class="token parameter variable">--namespace</span> kube-system <span class="token parameter variable">--wait</span> <span class="token parameter variable">--values</span> - cluster-autoscaler autoscaler/cluster-autoscaler <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
autoDiscovery:
  clusterName: <span class="token variable">${CLUSTER_NAME}</span>
awsRegion: <span class="token variable">${AWS_DEFAULT_REGION}</span>
# Required to fix IMDSv2 issue: https://github.com/kubernetes/autoscaler/issues/3592
extraArgs:
  aws-use-static-instance-list: true
rbac:
  serviceAccount:
    create: false
    name: cluster-autoscaler
serviceMonitor:
  enabled: true
  namespace: kube-prometheus-stack
prometheusRule:
  enabled: false
  namespace: kube-prometheus-stack
EOF</span>
<span class="token function">sleep</span> <span class="token number">10</span>
</code></pre></div><p>You can test it by running <code>pause</code> container consuming <code>cpu: 3</code> resources :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> - <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pasue-deployment
  labels:
    app: pause
  annotations:
    ignore-check.kube-linter.io/no-read-only-root-fs : &quot;Not needed&quot;
spec:
  replicas: 15
  selector:
    matchLabels:
      app: pause
  template:
    metadata:
      labels:
        app: pause
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - topologyKey: &quot;kubernetes.io/hostname&quot;
            labelSelector:
              matchLabels:
                app: pause
      containers:
      - name: pause
        image: k8s.gcr.io/pause:3.6
        resources:
          requests:
            cpu: 100m
            memory: &quot;1024Mi&quot;
          limits:
            cpu: 100m
            memory: &quot;1024Mi&quot;
      securityContext:
        runAsUser: 10001
EOF</span>
</code></pre></div><p>There should be 3 nodes started by default:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get nodes <span class="token parameter variable">-L</span> node.kubernetes.io/instance-type <span class="token parameter variable">-L</span> topology.kubernetes.io/zone
<span class="token function">sleep</span> <span class="token number">70</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>NAME                                           STATUS   ROLES    AGE   VERSION   INSTANCE-TYPE   ZONE
ip-192-168-31-11.eu-west-1.compute.internal    Ready    &amp;lt;none&gt;   21m   v1.21.6   t3.xlarge       eu-west-1a
ip-192-168-56-82.eu-west-1.compute.internal    Ready    &amp;lt;none&gt;   21m   v1.21.6   t3.xlarge       eu-west-1b
ip-192-168-60-184.eu-west-1.compute.internal   Ready    &amp;lt;none&gt;   21m   v1.21.6   t3.xlarge       eu-west-1b
</code></pre></div><p>Check the details - some pods are still in pending state
(they are waiting for new node):</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get pods <span class="token parameter variable">-o</span> wide
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>NAME                                READY   STATUS              RESTARTS   AGE   IP               NODE                                           NOMINATED NODE   READINESS GATES
pasue-deployment-648c54d8c6-498tx   0/1     Pending             0          70s   &amp;lt;none&gt;           &amp;lt;none&gt;                                         &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-4wr5f   1/1     Running             0          71s   172.16.166.146   ip-192-168-56-82.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-579dx   1/1     Running             0          70s   172.16.2.147     ip-192-168-31-11.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-5vqrr   1/1     Running             0          70s   172.16.3.89      ip-192-168-60-184.eu-west-1.compute.internal   &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-5zr8k   1/1     Running             0          70s   172.16.166.147   ip-192-168-56-82.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-7kd65   0/1     ContainerCreating   0          70s   &amp;lt;none&gt;           ip-192-168-3-25.eu-west-1.compute.internal     &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-kknlr   1/1     Running             0          70s   172.16.3.88      ip-192-168-60-184.eu-west-1.compute.internal   &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-pcsb8   0/1     ContainerCreating   0          70s   &amp;lt;none&gt;           ip-192-168-3-25.eu-west-1.compute.internal     &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-qcdpw   1/1     Running             0          70s   172.16.2.146     ip-192-168-31-11.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-s8qcm   0/1     ContainerCreating   0          70s   &amp;lt;none&gt;           ip-192-168-3-25.eu-west-1.compute.internal     &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-sl7mb   0/1     Pending             0          70s   &amp;lt;none&gt;           &amp;lt;none&gt;                                         &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-v7b5x   1/1     Running             0          71s   172.16.3.87      ip-192-168-60-184.eu-west-1.compute.internal   &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-vmshk   1/1     Running             0          71s   172.16.2.145     ip-192-168-31-11.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-zfqfx   1/1     Running             0          70s   172.16.166.148   ip-192-168-56-82.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-zpmg5   0/1     ContainerCreating   0          70s   &amp;lt;none&gt;           ip-192-168-3-25.eu-west-1.compute.internal     &amp;lt;none&gt;           &amp;lt;none&gt;
</code></pre></div><p>The autoscaler ConfigMap should showing 1 more node which is starting up:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get configmap cluster-autoscaler-status <span class="token parameter variable">-o</span> yaml <span class="token parameter variable">-n</span> kube-system
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>apiVersion: v1
data:
  status: |+
    Cluster-autoscaler status at 2021-11-29 17:44:03.335055488 +0000 UTC:
    Cluster-wide:
      Health:      Healthy (ready=4 unready=0 notStarted=1 longNotStarted=0 registered=5 longUnregistered=0)
                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909
                   LastTransitionTime: 2021-11-29 17:42:52.673668227 +0000 UTC m=+11.566024230
      ScaleUp:     InProgress (ready=4 registered=5)
                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909
                   LastTransitionTime: 2021-11-29 17:43:02.702663909 +0000 UTC m=+21.595019844
      ScaleDown:   NoCandidates (candidates=0)
                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909
                   LastTransitionTime: 2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909

    NodeGroups:
      Name:        eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090
      Health:      Healthy (ready=4 unready=0 notStarted=1 longNotStarted=0 registered=5 longUnregistered=0 cloudProviderTarget=5 (minSize=2, maxSize=5))
                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909
                   LastTransitionTime: 2021-11-29 17:42:52.673668227 +0000 UTC m=+11.566024230
      ScaleUp:     InProgress (ready=4 cloudProviderTarget=5)
                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909
                   LastTransitionTime: 2021-11-29 17:43:02.702663909 +0000 UTC m=+21.595019844
      ScaleDown:   NoCandidates (candidates=0)
                   LastProbeTime:      2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909
                   LastTransitionTime: 2021-11-29 17:44:03.332119893 +0000 UTC m=+82.224475909

kind: ConfigMap
metadata:
  annotations:
    cluster-autoscaler.kubernetes.io/last-updated: 2021-11-29 17:44:03.335055488 +0000
      UTC
  creationTimestamp: &quot;2021-11-29T17:42:41Z&quot;
  name: cluster-autoscaler-status
  namespace: kube-system
  resourceVersion: &quot;16437&quot;
  uid: 5b5084d7-9af3-4665-b829-ab210c9a633d
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># shellcheck disable=SC1083</span>
kubectl logs <span class="token parameter variable">-n</span> kube-system <span class="token parameter variable">--since</span><span class="token operator">=</span>1m <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>kubectl get pods <span class="token parameter variable">-n</span> kube-system <span class="token parameter variable">-l</span> app.kubernetes.io/name<span class="token operator">=</span>aws-cluster-autoscaler <span class="token parameter variable">-o</span><span class="token operator">=</span>jsonpath<span class="token operator">=</span><span class="token string">&quot;{.items[0].metadata.name}&quot;</span><span class="token variable">)</span></span>&quot;</span>
<span class="token function">sleep</span> <span class="token number">100</span>
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>...
I1129 17:43:53.270450       1 static_autoscaler.go:228] Starting main loop
I1129 17:43:53.292923       1 filter_out_schedulable.go:65] Filtering out schedulables
I1129 17:43:53.292975       1 filter_out_schedulable.go:132] Filtered out 0 pods using hints
I1129 17:43:53.293049       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-pcsb8 marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-0. Ignoring in scale up.
I1129 17:43:53.293094       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-7kd65 marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-0. Ignoring in scale up.
I1129 17:43:53.293120       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-498tx marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-0. Ignoring in scale up.
I1129 17:43:53.293147       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-sl7mb marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-0. Ignoring in scale up.
I1129 17:43:53.293176       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-zpmg5 marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-1. Ignoring in scale up.
I1129 17:43:53.293201       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-s8qcm marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-4548432111829895923-1. Ignoring in scale up.
I1129 17:43:53.293209       1 filter_out_schedulable.go:170] 0 pods were kept as unschedulable based on caching
I1129 17:43:53.293216       1 filter_out_schedulable.go:171] 6 pods marked as unschedulable can be scheduled.
I1129 17:43:53.293234       1 filter_out_schedulable.go:79] Schedulable pods present
I1129 17:43:53.293257       1 static_autoscaler.go:401] No unschedulable pods
I1129 17:43:53.293279       1 static_autoscaler.go:448] Calculating unneeded nodes
I1129 17:43:53.293356       1 scale_down.go:447] Node ip-192-168-3-25.eu-west-1.compute.internal - cpu utilization 0.102041
I1129 17:43:53.293385       1 scale_down.go:447] Node ip-192-168-31-113.eu-west-1.compute.internal - cpu utilization 0.102041
I1129 17:43:53.293401       1 scale_down.go:508] Scale-down calculation: ignoring 3 nodes unremovable in the last 5m0s
I1129 17:43:53.293516       1 static_autoscaler.go:491] ip-192-168-3-25.eu-west-1.compute.internal is unneeded since 2021-11-29 17:43:42.944989763 +0000 UTC m=+61.837345699 duration 10.32542882s
I1129 17:43:53.293537       1 static_autoscaler.go:491] ip-192-168-31-113.eu-west-1.compute.internal is unneeded since 2021-11-29 17:43:42.944989763 +0000 UTC m=+61.837345699 duration 10.32542882s
I1129 17:43:53.293554       1 static_autoscaler.go:502] Scale down status: unneededOnly=true lastScaleUpTime=2021-11-29 17:43:02.702663909 +0000 UTC m=+21.595019844 lastScaleDownDeleteTime=2021-11-29 17:42:42.673088267 +0000 UTC m=+1.565444188 lastScaleDownFailTime=2021-11-29 17:42:42.673088334 +0000 UTC m=+1.565444256 scaleDownForbidden=true isDeleteInProgress=false scaleDownInCooldown=true
I1129 17:44:03.332155       1 static_autoscaler.go:228] Starting main loop
I1129 17:44:03.333608       1 filter_out_schedulable.go:65] Filtering out schedulables
I1129 17:44:03.333641       1 filter_out_schedulable.go:132] Filtered out 0 pods using hints
I1129 17:44:03.334074       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-498tx marked as unschedulable can be scheduled on node ip-192-168-31-113.eu-west-1.compute.internal. Ignoring in scale up.
I1129 17:44:03.334135       1 filter_out_schedulable.go:157] Pod default.pasue-deployment-648c54d8c6-sl7mb marked as unschedulable can be scheduled on node template-node-for-eks-managed-ng-1-04beb65b-308f-11f3-e139-b0ebbe48a090-8549944162621642512-0. Ignoring in scale up.
I1129 17:44:03.334209       1 filter_out_schedulable.go:170] 0 pods were kept as unschedulable based on caching
I1129 17:44:03.334226       1 filter_out_schedulable.go:171] 2 pods marked as unschedulable can be scheduled.
I1129 17:44:03.334269       1 filter_out_schedulable.go:79] Schedulable pods present
I1129 17:44:03.334300       1 static_autoscaler.go:401] No unschedulable pods
I1129 17:44:03.334319       1 static_autoscaler.go:448] Calculating unneeded nodes
I1129 17:44:03.334411       1 scale_down.go:443] Node ip-192-168-3-25.eu-west-1.compute.internal is not suitable for removal - memory utilization too big (0.989735)
I1129 17:44:03.334457       1 scale_down.go:447] Node ip-192-168-31-113.eu-west-1.compute.internal - memory utilization 0.300287
I1129 17:44:03.334505       1 scale_down.go:508] Scale-down calculation: ignoring 3 nodes unremovable in the last 5m0s
I1129 17:44:03.334578       1 cluster.go:148] Fast evaluation: ip-192-168-31-113.eu-west-1.compute.internal for removal
I1129 17:44:03.334761       1 cluster.go:192] Fast evaluation: node ip-192-168-31-113.eu-west-1.compute.internal is not suitable for removal: failed to find place for default/pasue-deployment-648c54d8c6-498tx
I1129 17:44:03.334810       1 scale_down.go:612] 1 nodes found to be unremovable in simulation, will re-check them at 2021-11-29 17:49:03.332119893 +0000 UTC m=+382.224475909
I1129 17:44:03.334891       1 static_autoscaler.go:502] Scale down status: unneededOnly=true lastScaleUpTime=2021-11-29 17:43:02.702663909 +0000 UTC m=+21.595019844 lastScaleDownDeleteTime=2021-11-29 17:42:42.673088267 +0000 UTC m=+1.565444188 lastScaleDownFailTime=2021-11-29 17:42:42.673088334 +0000 UTC m=+1.565444256 scaleDownForbidden=true isDeleteInProgress=false scaleDownInCooldown=true
</code></pre></div><p>The <code>cluster-autoscaler</code> should start one more node after some time:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get nodes <span class="token parameter variable">-L</span> node.kubernetes.io/instance-type <span class="token parameter variable">-L</span> topology.kubernetes.io/zone
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>NAME                                           STATUS   ROLES    AGE     VERSION   INSTANCE-TYPE   ZONE
ip-192-168-3-25.eu-west-1.compute.internal     Ready    &amp;lt;none&gt;   2m10s   v1.21.6   t3.xlarge       eu-west-1a
ip-192-168-31-11.eu-west-1.compute.internal    Ready    &amp;lt;none&gt;   23m     v1.21.6   t3.xlarge       eu-west-1a
ip-192-168-31-113.eu-west-1.compute.internal   Ready    &amp;lt;none&gt;   2m4s    v1.21.6   t3.xlarge       eu-west-1a
ip-192-168-56-82.eu-west-1.compute.internal    Ready    &amp;lt;none&gt;   23m     v1.21.6   t3.xlarge       eu-west-1b
ip-192-168-60-184.eu-west-1.compute.internal   Ready    &amp;lt;none&gt;   23m     v1.21.6   t3.xlarge       eu-west-1b
</code></pre></div><p>All pods should be running now and some of them are are on the new node:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get pods <span class="token parameter variable">-o</span> wide
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>NAME                                READY   STATUS    RESTARTS   AGE     IP               NODE                                           NOMINATED NODE   READINESS GATES
pasue-deployment-648c54d8c6-498tx   1/1     Running   0          2m53s   172.16.72.1      ip-192-168-31-113.eu-west-1.compute.internal   &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-4wr5f   1/1     Running   0          2m54s   172.16.166.146   ip-192-168-56-82.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-579dx   1/1     Running   0          2m53s   172.16.2.147     ip-192-168-31-11.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-5vqrr   1/1     Running   0          2m53s   172.16.3.89      ip-192-168-60-184.eu-west-1.compute.internal   &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-5zr8k   1/1     Running   0          2m53s   172.16.166.147   ip-192-168-56-82.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-7kd65   1/1     Running   0          2m53s   172.16.190.8     ip-192-168-3-25.eu-west-1.compute.internal     &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-kknlr   1/1     Running   0          2m53s   172.16.3.88      ip-192-168-60-184.eu-west-1.compute.internal   &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-pcsb8   1/1     Running   0          2m53s   172.16.190.4     ip-192-168-3-25.eu-west-1.compute.internal     &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-qcdpw   1/1     Running   0          2m53s   172.16.2.146     ip-192-168-31-11.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-s8qcm   1/1     Running   0          2m53s   172.16.190.1     ip-192-168-3-25.eu-west-1.compute.internal     &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-sl7mb   1/1     Running   0          2m53s   172.16.72.2      ip-192-168-31-113.eu-west-1.compute.internal   &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-v7b5x   1/1     Running   0          2m54s   172.16.3.87      ip-192-168-60-184.eu-west-1.compute.internal   &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-vmshk   1/1     Running   0          2m54s   172.16.2.145     ip-192-168-31-11.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-zfqfx   1/1     Running   0          2m53s   172.16.166.148   ip-192-168-56-82.eu-west-1.compute.internal    &amp;lt;none&gt;           &amp;lt;none&gt;
pasue-deployment-648c54d8c6-zpmg5   1/1     Running   0          2m53s   172.16.190.5     ip-192-168-3-25.eu-west-1.compute.internal     &amp;lt;none&gt;           &amp;lt;none&gt;
</code></pre></div><p>If you delete the deployment <code>autoscaler-demo</code> the <code>cluster-autoscaler</code> will
decrease the number of nodes:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl delete deployment pasue-deployment
<span class="token function">sleep</span> <span class="token number">800</span>
kubectl get nodes <span class="token parameter variable">-L</span> node.kubernetes.io/instance-type <span class="token parameter variable">-L</span> topology.kubernetes.io/zone
</code></pre></div><p>Output:</p> <div class="language-text extra-class"><pre class="language-text"><code>NAME                                           STATUS                     ROLES    AGE   VERSION   INSTANCE-TYPE   ZONE
ip-192-168-31-11.eu-west-1.compute.internal    Ready                      &amp;lt;none&gt;   37m   v1.21.6   t3.xlarge       eu-west-1a
ip-192-168-31-113.eu-west-1.compute.internal   Ready,SchedulingDisabled   &amp;lt;none&gt;   15m   v1.21.6   t3.xlarge       eu-west-1a
ip-192-168-56-82.eu-west-1.compute.internal    Ready                      &amp;lt;none&gt;   37m   v1.21.6   t3.xlarge       eu-west-1b
ip-192-168-60-184.eu-west-1.compute.internal   Ready                      &amp;lt;none&gt;   37m   v1.21.6   t3.xlarge       eu-west-1b
</code></pre></div><h2 id="descheduler"><a href="#descheduler" class="header-anchor">#</a> Descheduler</h2> <p>Install <code>descheduler</code> <a href="https://artifacthub.io/packages/helm/descheduler/descheduler" target="_blank" rel="noopener noreferrer">helm chart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
and modify the
<a href="https://github.com/kubernetes-sigs/descheduler/blob/master/charts/descheduler/values.yaml" target="_blank" rel="noopener noreferrer">default values<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>helm repo <span class="token function">add</span> --force-update descheduler https://kubernetes-sigs.github.io/descheduler/
helm upgrade <span class="token parameter variable">--install</span> <span class="token parameter variable">--version</span> <span class="token number">0.21</span>.0 <span class="token parameter variable">--namespace</span> kube-system <span class="token parameter variable">--values</span> - descheduler descheduler/descheduler <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
cronJobApiVersion: &quot;batch/v1beta1&quot;
successfulJobsHistoryLimit: 10
EOF</span>
</code></pre></div><h2 id="rancher"><a href="#rancher" class="header-anchor">#</a> Rancher</h2> <p>Install <code>rancher-server</code> <a href="https://github.com/rancher/rancher/tree/master/chart" target="_blank" rel="noopener noreferrer">helm chart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
and modify the
<a href="https://github.com/rancher/rancher/blob/master/chart/values.yaml" target="_blank" rel="noopener noreferrer">default values<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>helm repo <span class="token function">add</span> --force-update rancher-latest https://releases.rancher.com/server-charts/latest
helm upgrade <span class="token parameter variable">--install</span> <span class="token parameter variable">--version</span> <span class="token number">2.5</span>.9 <span class="token parameter variable">--namespace</span> cattle-system --create-namespace <span class="token parameter variable">--values</span> - rancher rancher-latest/rancher <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
hostname: rancher.<span class="token variable">${CLUSTER_FQDN}</span>
ingress:
  extraAnnotations:
    nginx.ingress.kubernetes.io/auth-url: https://oauth2-proxy.<span class="token variable">${CLUSTER_FQDN}</span>/oauth2/auth
    nginx.ingress.kubernetes.io/auth-signin: https://oauth2-proxy.<span class="token variable">${CLUSTER_FQDN}</span>/oauth2/start?rd=\<span class="token variable">$scheme</span>://\<span class="token variable">$host</span>\<span class="token variable">$request_uri</span>
  tls:
    source: secret
    # Not working right now
    secretName: ingress-cert-<span class="token variable">${LETSENCRYPT_ENVIRONMENT}</span>
replicas: 1
EOF</span>
</code></pre></div><p>Copy the certificate to the secret with name: <code>tls-rancher-ingress</code>.
Rancher <a href="https://github.com/rancher/rancher/blob/3c54189441fdac08fd4a1b3113216e085004f061/chart/templates/ingress.yaml#L55" target="_blank" rel="noopener noreferrer">helm chart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
can not use existing secret for TLS ingress 😦
It should be fixed in next helm chart release...</p> <div class="language-bash extra-class"><pre class="language-bash"><code>kubectl get secret <span class="token parameter variable">-n</span> cattle-system tls-rancher-ingress <span class="token operator">||</span> kubectl get secret <span class="token parameter variable">-n</span> cattle-system <span class="token string">&quot;ingress-cert-<span class="token variable">${LETSENCRYPT_ENVIRONMENT}</span>&quot;</span> <span class="token parameter variable">-o</span> json <span class="token operator">|</span> jq <span class="token string">&quot;.metadata.name=<span class="token entity" title="\&quot;">\&quot;</span>tls-rancher-ingress<span class="token entity" title="\&quot;">\&quot;</span>&quot;</span> <span class="token operator">|</span> kubectl apply <span class="token parameter variable">-f</span> -
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ruzickap/k8s-eks-bottlerocket-fargate/edit/main/docs/part-06/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/30/2024, 4:19:34 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/k8s-eks-bottlerocket-fargate/part-05/" class="prev">
        Authentication
      </a></span> <span class="next"><a href="/k8s-eks-bottlerocket-fargate/part-07/">
        Workloads
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/k8s-eks-bottlerocket-fargate/assets/js/app.cd5c61da.js" defer></script><script src="/k8s-eks-bottlerocket-fargate/assets/js/2.a27de003.js" defer></script><script src="/k8s-eks-bottlerocket-fargate/assets/js/1.30a6593f.js" defer></script><script src="/k8s-eks-bottlerocket-fargate/assets/js/28.f566dccc.js" defer></script>
  </body>
</html>
